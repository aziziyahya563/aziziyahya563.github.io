<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="theme-color" content="#0a0a0f" id="themeColorMeta" />
    <title>Name List Updater</title>
    <link rel="stylesheet" href="css/updater.css" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
  </head>
  <script>
    (function () {
      const t = localStorage.getItem("APP_THEME");
      const prefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)",
      ).matches;
      const isDark = t ? t === "dark" : prefersDark;
      if (isDark) {
        document.documentElement.setAttribute("data-theme", "dark");
      } else if (t) {
        document.documentElement.setAttribute("data-theme", t);
      }
      const m = document.getElementById("themeColorMeta");
      if (m) m.content = isDark ? "#0a0a0f" : "#f0f2f8";
    })();
  </script>

  <body>
    <!-- Mesh background -->
    <div class="bg-mesh" aria-hidden="true"></div>

    <div class="click-outside" id="clickOutside" onclick="toggleMenu()"></div>

    <!-- Popover Menu -->
    <div class="popover-menu" id="popoverMenu" role="menu">
      <div
        style="
          padding: 10px 14px 6px;
          font-size: 11px;
          font-weight: 600;
          letter-spacing: 0.8px;
          text-transform: uppercase;
          color: var(--text-muted);
        "
      >
        Settings
      </div>
      <div style="height: 1px; background: var(--border); margin: 4px 0"></div>
      <div class="menu-item" onclick="toggleThemeMode()" role="menuitem">
        <div style="display: flex; align-items: center; gap: 10px">
          <div
            style="
              width: 28px;
              height: 28px;
              border-radius: 8px;
              background: color-mix(in srgb, var(--accent) 12%, transparent);
              color: var(--accent);
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <svg
              width="15"
              height="15"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
            </svg>
          </div>
          <span>Dark Mode</span>
        </div>
        <div class="switch" style="pointer-events: none">
          <input type="checkbox" id="themeSwitch" />
          <span class="slider"></span>
        </div>
      </div>
      <div style="height: 1px; background: var(--border); margin: 4px 0"></div>
      <button class="menu-item" onclick="openInfoModal()" role="menuitem">
        <div style="display: flex; align-items: center; gap: 10px">
          <div
            style="
              width: 28px;
              height: 28px;
              border-radius: 8px;
              background: rgba(6, 182, 212, 0.12);
              color: #06b6d4;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <svg
              width="15"
              height="15"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="16" x2="12" y2="12" />
              <line x1="12" y1="8" x2="12.01" y2="8" />
            </svg>
          </div>
          <span>About</span>
        </div>
        <svg
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2.5"
          stroke-linecap="round"
          stroke-linejoin="round"
          style="color: var(--text-muted)"
        >
          <polyline points="9 18 15 12 9 6" />
        </svg>
      </button>
    </div>

    <header>
      <a
        href="index.html"
        class="back-btn-absolute"
        title="Home"
        aria-label="Back to home"
      >
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </a>
      <div class="header-title-block">
        <div class="header-eyebrow">Utilities</div>
        <div class="brand">Name List Updater</div>
      </div>

      <!-- Header right: theme toggle + menu -->
      <div class="header-extras">
        <button
          class="icon-btn"
          onclick="quickToggleTheme()"
          aria-label="Toggle dark mode"
        >
          <svg
            id="themeIconSun"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="4" />
            <path
              d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"
            />
          </svg>
          <svg
            id="themeIconMoon"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="display: none"
          >
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
          </svg>
        </button>
        <button
          class="menu-btn"
          id="menuBtn"
          onclick="toggleMenu()"
          aria-label="Open menu"
          aria-expanded="false"
        >
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="5" r="1" fill="currentColor" />
            <circle cx="12" cy="12" r="1" fill="currentColor" />
            <circle cx="12" cy="19" r="1" fill="currentColor" />
          </svg>
        </button>
      </div>
    </header>

    <main>
      <div class="editor-wrapper">
        <div class="status-bar">
          <div class="status-badge">
            <div class="status-dot"></div>
            <span id="statusText">Ready</span>
          </div>
          <span id="lineCount">0 lines</span>
        </div>
        <textarea
          id="mainEditor"
          placeholder=" // Paste a namelist here..."
        ></textarea>
      </div>

      <!-- Floating Action Pills -->
      <div class="action-pills">
        <button class="pill-btn danger" onclick="updater.clearText()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="3 6 5 6 21 6" />
            <path
              d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
            />
            <line x1="10" y1="11" x2="10" y2="17" />
            <line x1="14" y1="11" x2="14" y2="17" />
          </svg>
          Clear
        </button>
      </div>

      <!-- Bottom Control Bar -->
      <div class="bottom-bar">
        <button
          id="settingsBtn"
          class="control-btn secondary"
          title="Edit My Profile"
          aria-label="Edit profile"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
            />
            <circle cx="12" cy="12" r="3" />
          </svg>
        </button>
        <button id="addMeBtn" class="control-btn primary">
          <span class="btn-text">Add Me &amp; Copy</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
            <circle cx="8.5" cy="7" r="4" />
            <line x1="20" y1="8" x2="20" y2="14" />
            <line x1="23" y1="11" x2="17" y2="11" />
          </svg>
        </button>
      </div>
    </main>

    <!-- Profile Setup Modal -->
    <div id="modalOverlay" class="modal-overlay">
      <div
        class="modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="profileModalTitle"
      >
        <div class="modal-header">
          <h2 id="profileModalTitle">Your Profile</h2>
          <button
            class="close-modal"
            onclick="updater.closeSettings()"
            aria-label="Close"
          >
            ✕
          </button>
        </div>
        <div class="modal-body">
          <p class="modal-desc">
            Set this once. We'll match the format automatically.
          </p>

          <div class="form-group">
            <label>Full Name</label>
            <input
              type="text"
              id="myFullName"
              placeholder="e.g. Ahmad bin Albab"
            />
          </div>

          <div class="form-group row">
            <div class="col">
              <label>Nickname</label>
              <input type="text" id="myNickName" placeholder="e.g. Ahmad" />
            </div>
            <div class="col">
              <label>Matric No.</label>
              <input
                type="text"
                id="myMatric"
                placeholder="A19EC0123"
                inputmode="text"
              />
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button
            class="pill-btn primary full-width"
            onclick="updater.saveSettings()"
          >
            Save Profile
          </button>
        </div>
      </div>
    </div>

    <!-- Info Modal -->
    <div id="infoModalApp" class="modal-overlay">
      <div class="modal" role="dialog" aria-modal="true">
        <div
          class="modal-body"
          style="text-align: center; padding: 36px 32px 28px"
        >
          <div
            style="
              width: 60px;
              height: 60px;
              border-radius: 18px;
              background: linear-gradient(135deg, #6366f1, #8b5cf6);
              display: flex;
              align-items: center;
              justify-content: center;
              margin: 0 auto 20px;
              box-shadow: 0 12px 30px rgba(99, 102, 241, 0.3);
            "
          >
            <svg
              width="28"
              height="28"
              viewBox="0 0 24 24"
              fill="none"
              stroke="white"
              stroke-width="1.8"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
              <circle cx="9" cy="7" r="4" />
              <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
              <path d="M16 3.13a4 4 0 0 1 0 7.75" />
            </svg>
          </div>
          <div
            style="
              display: inline-block;
              font-size: 11px;
              font-weight: 700;
              letter-spacing: 0.5px;
              padding: 4px 12px;
              border-radius: 99px;
              background: rgba(99, 102, 241, 0.1);
              color: #6366f1;
              margin-bottom: 12px;
            "
          >
            v1.3
          </div>
          <h4
            style="
              margin: 0 0 12px;
              font-size: 20px;
              font-weight: 800;
              letter-spacing: -0.4px;
              color: var(--text-h);
            "
          >
            Name List Updater
          </h4>
          <p class="modal-desc" style="margin-bottom: 0">
            Effortlessly transform raw text into
            <strong>organized, formatted lists</strong> — paste, add your name,
            and copy in seconds.<br /><br />
            <span style="font-size: 12px; color: var(--text-muted)"
              >© 2026 Azizi Yahya</span
            >
          </p>
        </div>
        <div class="modal-footer">
          <button
            class="pill-btn primary full-width"
            onclick="closeInfoModal()"
          >
            Got it
          </button>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="spinner"></div>
      <div class="loading-text">Processing...</div>
    </div>

    <div id="toast">Copied to clipboard</div>

    <script>
      /* ── Theme helpers ─────────────────────────── */
      function applyThemeIcons(isDark) {
        const sun = document.getElementById("themeIconSun");
        const moon = document.getElementById("themeIconMoon");
        const meta = document.getElementById("themeColorMeta");
        if (sun) sun.style.display = isDark ? "none" : "";
        if (moon) moon.style.display = isDark ? "" : "none";
        if (meta) meta.content = isDark ? "#0a0a0f" : "#f0f2f8";
      }

      function applyTheme(isDark) {
        if (isDark) {
          document.body.classList.add("dark-mode");
          document.documentElement.setAttribute("data-theme", "dark");
          localStorage.setItem("APP_THEME", "dark");
        } else {
          document.body.classList.remove("dark-mode");
          document.documentElement.setAttribute("data-theme", "light");
          localStorage.setItem("APP_THEME", "light");
        }
        const cb = document.getElementById("themeSwitch");
        if (cb) cb.checked = isDark;
        applyThemeIcons(isDark);
      }

      function toggleThemeMode() {
        const isDark =
          document.documentElement.getAttribute("data-theme") === "dark";
        applyTheme(!isDark);
      }

      function quickToggleTheme() {
        const isDark =
          document.documentElement.getAttribute("data-theme") === "dark";
        applyTheme(!isDark);
      }

      /* ── Menu helpers ──────────────────────────── */
      function toggleMenu() {
        const menu = document.getElementById("popoverMenu");
        const overlay = document.getElementById("clickOutside");
        const btn = document.getElementById("menuBtn");
        if (!menu || !overlay) return;
        const isOpen = menu.classList.toggle("active");
        overlay.style.display = isOpen ? "block" : "none";
        if (btn) btn.setAttribute("aria-expanded", isOpen);

        if (isOpen && btn) {
          const rect = btn.getBoundingClientRect();
          menu.style.top = rect.bottom + 8 + "px";
          menu.style.right = window.innerWidth - rect.right + "px";
        }
      }

      /* ── Info Modal ────────────────────────────── */
      function openInfoModal() {
        const menu = document.getElementById("popoverMenu");
        if (menu && menu.classList.contains("active")) toggleMenu();
        setTimeout(() => {
          document.getElementById("infoModalApp").classList.add("show");
        }, 50);
      }

      function closeInfoModal() {
        document.getElementById("infoModalApp").classList.remove("show");
      }

      /* ── Init theme on load ────────────────────── */
      (function () {
        const saved = localStorage.getItem("APP_THEME");
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)",
        ).matches;
        const isDark = saved === "dark" || (!saved && prefersDark);

        if (isDark) document.body.classList.add("dark-mode");

        const cb = document.getElementById("themeSwitch");
        if (cb) cb.checked = isDark;
        applyThemeIcons(isDark);
      })();

      /* ── Cross-tab theme sync ──────────────────── */
      window.addEventListener("storage", (e) => {
        if (e.key === "APP_THEME") {
          applyTheme(e.newValue === "dark");
        }
      });
    </script>
    <script src="js/updater.js"></script>
  </body>
</html>
