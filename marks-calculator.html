<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="theme-color" content="#0a0a0f" id="themeColorMeta" />
    <meta
      name="description"
      content="Grade Calculator — Track your continuous assessment marks and estimate your final grade."
    />
    <title>Grade Calculator</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <style>
      /* ── Reset ─────────────────────────────────────── */
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      /* ── Tokens ────────────────────────────────────── */
      :root {
        --accent: #10b981;
        --accent-2: #059669;
        --accent-glow: rgba(16, 185, 129, 0.25);
        --a1: #7c6fee;
        --a2: #ec4899;
        --a3: #06b6d4;

        --bg: #f0f2f8;
        --surface: rgba(255, 255, 255, 0.78);
        --surface-s: #ffffff;
        --input-bg: rgba(0, 0, 0, 0.04);
        --border: rgba(0, 0, 0, 0.07);
        --text-h: #0d0f1a;
        --text-p: #4a5069;
        --text-muted: #8892b0;
        --shadow: 0 4px 24px rgba(0, 0, 0, 0.07);
        --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.12);
        --header-bg: rgba(240, 242, 248, 0.88);
        --r-xl: 24px;
        --r-lg: 18px;
        --r-md: 14px;
        --r-sm: 10px;
      }

      [data-theme="dark"] {
        --bg: #0a0a0f;
        --surface: rgba(22, 22, 34, 0.82);
        --surface-s: #16161f;
        --input-bg: rgba(255, 255, 255, 0.05);
        --border: rgba(255, 255, 255, 0.08);
        --text-h: #f0f2ff;
        --text-p: #8892b0;
        --text-muted: #4a5069;
        --shadow: 0 4px 24px rgba(0, 0, 0, 0.5);
        --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.7);
        --header-bg: rgba(10, 10, 15, 0.88);
      }

      /* ── Base ──────────────────────────────────────── */
      html,
      body {
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        background: var(--bg);
        color: var(--text-h);
        min-height: 100vh;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        transition:
          background 0.4s,
          color 0.4s;
      }

      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding-bottom: 48px;
      }

      /* ── Mesh Background ───────────────────────────── */
      .bg-mesh {
        position: fixed;
        inset: 0;
        z-index: 0;
        overflow: hidden;
        pointer-events: none;
      }
      .bg-mesh::before,
      .bg-mesh::after {
        content: "";
        position: absolute;
        border-radius: 50%;
        filter: blur(90px);
        opacity: 0.3;
      }
      [data-theme="dark"] .bg-mesh::before,
      [data-theme="dark"] .bg-mesh::after {
        opacity: 0.14;
      }
      .bg-mesh::before {
        width: 70vw;
        height: 70vw;
        top: -20vw;
        left: -20vw;
        background: radial-gradient(circle, #7c6fee, #10b981);
        animation: floatA 18s ease-in-out infinite alternate;
      }
      .bg-mesh::after {
        width: 55vw;
        height: 55vw;
        bottom: -15vw;
        right: -15vw;
        background: radial-gradient(circle, #06b6d4, #10b981);
        animation: floatB 22s ease-in-out infinite alternate;
      }
      @keyframes floatA {
        from {
          transform: translate(0, 0) scale(1);
        }
        to {
          transform: translate(6vw, 5vw) scale(1.1);
        }
      }
      @keyframes floatB {
        from {
          transform: translate(0, 0) scale(1);
        }
        to {
          transform: translate(-5vw, -6vw) scale(1.08);
        }
      }

      /* ── Sticky Header ─────────────────────────────── */
      .site-header {
        position: sticky;
        top: 0;
        z-index: 100;
        width: 100%;
        background: var(--header-bg);
        backdrop-filter: blur(24px) saturate(1.8);
        -webkit-backdrop-filter: blur(24px) saturate(1.8);
        border-bottom: 1px solid var(--border);
        padding: 0 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 56px;
        transition: background 0.4s;
        animation: slideDown 0.55s cubic-bezier(0.16, 1, 0.3, 1);
      }
      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .back-btn {
        width: 34px;
        height: 34px;
        border-radius: 50%;
        background: var(--surface);
        border: 1px solid var(--border);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: var(--text-h);
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: var(--shadow);
        flex-shrink: 0;
      }
      .back-btn:hover {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-glow);
      }
      .back-btn:active {
        transform: scale(0.9);
      }
      .back-btn svg {
        width: 16px;
        height: 16px;
        stroke-width: 2.5;
      }

      .header-title-block {
        display: flex;
        flex-direction: column;
        gap: 0;
      }
      .header-eyebrow {
        font-size: 10px;
        font-weight: 600;
        letter-spacing: 1px;
        text-transform: uppercase;
        color: var(--accent);
        line-height: 1;
      }
      .header-title {
        font-size: 15px;
        font-weight: 800;
        letter-spacing: -0.3px;
        background: linear-gradient(135deg, var(--text-h) 40%, var(--text-p));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        line-height: 1.2;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .icon-btn {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--surface);
        border: 1px solid var(--border);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--text-p);
        transition: all 0.2s ease;
        box-shadow: var(--shadow);
      }
      .icon-btn:hover {
        color: var(--text-h);
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-glow);
      }
      .icon-btn:active {
        transform: scale(0.93);
      }
      .icon-btn svg {
        width: 18px;
        height: 18px;
        stroke-width: 2;
      }

      /* ── Dashboard Content ────────────────────────── */
      .dashboard {
        position: relative;
        z-index: 1;
        width: 100%;
        max-width: 500px;
        padding: 28px 18px 0;
        display: flex;
        flex-direction: column;
        gap: 16px;
        animation: fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) both;
      }
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(18px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ── Section label ────────────────────────────── */
      .section-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 2px;
      }
      .section-label {
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 1.2px;
        text-transform: uppercase;
        color: var(--text-muted);
      }
      .section-line {
        flex: 1;
        height: 1px;
        background: var(--border);
      }
      .section-count {
        font-size: 11px;
        font-weight: 600;
        color: var(--text-muted);
      }

      /* ── Course Cards ─────────────────────────────── */
      .courses-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .course-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--r-xl);
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        animation: fadeUp 0.55s cubic-bezier(0.16, 1, 0.3, 1) both;
      }
      .course-card::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: var(--card-accent, var(--accent));
        opacity: 0;
        transition: opacity 0.2s;
        border-radius: 0 2px 2px 0;
      }
      .course-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
        border-color: var(--card-accent, var(--accent));
      }
      .course-card:hover::before {
        opacity: 1;
      }
      .course-card:active {
        transform: scale(0.97);
      }

      .course-card.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        filter: grayscale(0.4);
      }
      .course-card.disabled:hover {
        transform: none;
        box-shadow: var(--shadow);
        border-color: var(--border);
      }
      .course-card.disabled::after {
        content: "Soon";
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--text-muted);
        color: var(--surface-s);
        font-size: 9px;
        font-weight: 700;
        padding: 3px 7px;
        border-radius: 99px;
        letter-spacing: 0.5px;
        text-transform: uppercase;
      }

      /* stagger */
      .course-card:nth-child(1) {
        animation-delay: 0.08s;
      }
      .course-card:nth-child(2) {
        animation-delay: 0.13s;
      }
      .course-card:nth-child(3) {
        animation-delay: 0.18s;
      }
      .course-card:nth-child(4) {
        animation-delay: 0.23s;
      }
      .course-card:nth-child(5) {
        animation-delay: 0.28s;
      }
      .course-card:nth-child(6) {
        animation-delay: 0.33s;
      }

      .card-icon {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        background: var(--card-accent, var(--accent));
        box-shadow: 0 6px 16px -4px
          color-mix(in srgb, var(--card-accent, var(--accent)) 40%, transparent);
      }
      .card-icon svg {
        width: 18px;
        height: 18px;
        stroke: white;
        stroke-width: 2;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .card-header {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .card-info {
        flex: 1;
        min-width: 0;
      }
      .card-code {
        font-size: 10px;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        color: var(--text-muted);
        margin-bottom: 2px;
      }
      .card-name {
        font-size: 13px;
        font-weight: 800;
        color: var(--text-h);
        line-height: 1.2;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .preview-section {
        border-top: 1px solid var(--border);
        padding-top: 10px;
      }
      .preview-label {
        font-size: 10px;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        color: var(--text-muted);
        margin-bottom: 6px;
      }
      .preview-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 12px;
        color: var(--text-p);
        margin-bottom: 4px;
        white-space: nowrap;
        overflow: hidden;
      }
      .preview-item:last-child {
        margin-bottom: 0;
      }
      .preview-item-name {
        overflow: hidden;
        text-overflow: ellipsis;
        flex: 1;
        padding-right: 8px;
      }
      .preview-val {
        font-weight: 700;
        color: var(--text-h);
        flex-shrink: 0;
      }
      .badge-pending {
        background: var(--input-bg);
        color: var(--text-muted);
        font-size: 10px;
        padding: 2px 7px;
        border-radius: 6px;
        font-weight: 600;
        font-style: italic;
        flex-shrink: 0;
      }

      /* ── Score Card ───────────────────────────────── */
      .score-display {
        border-radius: var(--r-xl);
        padding: 28px 24px;
        animation: fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.06s both;
        text-align: center;
        color: white;
        box-shadow: 0 16px 48px -8px rgba(16, 185, 129, 0.35);
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 14px;
        background: linear-gradient(
          135deg,
          #10b981 0%,
          #059669 60%,
          #0d9488 100%
        );
        background-size: 200% 200%;
        animation:
          fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.06s both,
          gradShift 8s ease infinite;
      }
      @keyframes gradShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      .score-display::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle at top right,
          rgba(255, 255, 255, 0.18),
          transparent 70%
        );
        pointer-events: none;
      }

      .course-code-pill {
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: rgba(0, 0, 0, 0.18);
        color: rgba(255, 255, 255, 0.92);
        padding: 6px 14px;
        border-radius: 99px;
        backdrop-filter: blur(4px);
      }

      .current-score {
        font-size: 3.2rem;
        font-weight: 900;
        line-height: 1;
        letter-spacing: -3px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.12);
      }
      @keyframes scorePulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }
      .score-pulse {
        animation: scorePulse 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      .target-box {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 99px;
        padding: 8px 18px;
        font-size: 13px;
        font-weight: 700;
        backdrop-filter: blur(4px);
        color: white;
        display: inline-flex;
        align-items: center;
      }

      /* ── Assessment Tiles ─────────────────────────── */
      .calc-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .assessment-tile {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--r-xl);
        padding: 16px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 10px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        min-height: 110px;
        animation: fadeUp 0.55s cubic-bezier(0.16, 1, 0.3, 1) both;
      }
      .assessment-tile:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-lg);
        border-color: var(--accent);
      }
      .assessment-tile:active {
        transform: scale(0.97);
      }

      .tile-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }
      .tile-name {
        font-size: 13px;
        font-weight: 700;
        color: var(--text-p);
        line-height: 1.3;
      }
      .tile-weight {
        font-size: 11px;
        font-weight: 700;
        color: var(--text-muted);
      }

      .input-area {
        background: var(--input-bg);
        border-radius: 12px;
        padding: 10px 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: auto;
        transition: all 0.2s ease;
      }
      .input-area:focus-within {
        background: var(--surface-s);
        box-shadow: 0 0 0 2px var(--accent);
        transform: scale(1.02);
      }

      .input-area input {
        width: 100%;
        background: transparent;
        border: none;
        outline: none;
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--text-h);
        font-family: "Inter", sans-serif;
        padding: 0;
        line-height: 1;
        font-variant-numeric: tabular-nums;
        transition: color 0.2s;
      }
      .input-area input:focus {
        color: var(--accent);
      }
      .input-area input::placeholder {
        color: var(--text-muted);
      }

      .den {
        font-size: 14px;
        font-weight: 700;
        color: var(--text-muted);
      }

      /* ── Menu ─────────────────────────────────────── */
      .click-outside {
        position: fixed;
        inset: 0;
        z-index: 999;
        display: none;
      }

      .menu-wrapper {
        position: relative;
      }

      .popover-menu {
        position: fixed;
        background: var(--surface-s);
        border: 1px solid var(--border);
        border-radius: var(--r-xl);
        padding: 8px;
        width: 220px;
        display: none;
        flex-direction: column;
        gap: 2px;
        z-index: 1000;
        box-shadow: var(--shadow-lg);
        transform-origin: top right;
        animation: menuIn 0.2s cubic-bezier(0.16, 1, 0.3, 1);
      }
      @keyframes menuIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      .popover-menu.active {
        display: flex;
      }

      .popover-menu-header {
        padding: 10px 14px 6px;
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 0.8px;
        text-transform: uppercase;
        color: var(--text-muted);
      }
      .popover-divider {
        height: 1px;
        background: var(--border);
        margin: 4px 0;
      }

      .menu-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 11px 14px;
        border-radius: 12px;
        cursor: pointer;
        color: var(--text-h);
        font-size: 14px;
        font-weight: 600;
        background: transparent;
        border: none;
        width: 100%;
        text-align: left;
        transition: background 0.15s;
      }
      .menu-item-left {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .menu-item-icon {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .menu-item-icon svg {
        width: 15px;
        height: 15px;
        stroke-width: 2;
      }
      .menu-item:hover {
        background: color-mix(in srgb, var(--text-h) 6%, transparent);
      }

      .switch {
        position: relative;
        width: 38px;
        height: 22px;
        flex-shrink: 0;
      }
      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        inset: 0;
        background: var(--text-muted);
        transition: 0.3s;
        border-radius: 34px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 3px;
        bottom: 3px;
        background: white;
        transition: 0.3s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      input:checked + .slider {
        background: var(--accent);
      }
      input:checked + .slider:before {
        transform: translateX(16px);
      }

      /* ── Modal ────────────────────────────────────── */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        z-index: 500;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 24px;
        opacity: 0;
        transition: opacity 0.3s;
      }
      .modal-overlay.active {
        display: flex;
        opacity: 1;
      }

      .modal-card {
        background: var(--surface-s);
        padding: 36px 32px 28px;
        border-radius: 28px;
        max-width: 340px;
        width: 100%;
        text-align: center;
        transform: translateY(24px) scale(0.96);
        transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
        border: 1px solid var(--border);
        box-shadow: var(--shadow-lg);
      }
      .modal-overlay.active .modal-card {
        transform: translateY(0) scale(1);
      }

      .modal-icon {
        width: 60px;
        height: 60px;
        border-radius: 18px;
        background: linear-gradient(135deg, var(--accent), #0d9488);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        box-shadow: 0 12px 30px rgba(16, 185, 129, 0.35);
      }
      .modal-icon svg {
        width: 28px;
        height: 28px;
        stroke: white;
        stroke-width: 1.8;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }
      .modal-version {
        display: inline-block;
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.5px;
        padding: 4px 12px;
        border-radius: 99px;
        margin-bottom: 12px;
        background: color-mix(in srgb, var(--accent) 12%, transparent);
        color: var(--accent);
      }
      .modal-title {
        font-size: 22px;
        font-weight: 800;
        letter-spacing: -0.5px;
        color: var(--text-h);
        margin-bottom: 10px;
      }
      .modal-text {
        font-size: 14px;
        color: var(--text-p);
        line-height: 1.65;
        margin-bottom: 24px;
      }
      .modal-text strong {
        color: var(--text-h);
        font-weight: 700;
      }
      .modal-btn {
        background: linear-gradient(135deg, var(--accent), #0d9488);
        color: white;
        border: none;
        padding: 13px 32px;
        border-radius: 99px;
        font-size: 14px;
        font-weight: 700;
        cursor: pointer;
        width: 100%;
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.35);
        transition:
          opacity 0.2s,
          transform 0.2s;
        font-family: "Inter", sans-serif;
      }
      .modal-btn:hover {
        opacity: 0.9;
      }
      .modal-btn:active {
        transform: scale(0.97);
      }

      /* ── Subject icon accent colours ─────────────── */
      .embedded-bg {
        --card-accent: #5b6bf0;
      }
      .security-bg {
        --card-accent: #00c896;
      }
      .practices-bg {
        --card-accent: #ff9f43;
      }
      .acquisition-bg {
        --card-accent: #9d4edd;
      }
      .german-bg {
        --card-accent: #ff6b6b;
      }
      .english-bg {
        --card-accent: #4895ef;
      }

      /* ── Desktop ──────────────────────────────────── */
      @media (min-width: 640px) {
        .dashboard {
          padding-top: 40px;
        }
      }
    </style>

    <script>
      (function () {
        const t = localStorage.getItem("APP_THEME");
        if (t) document.documentElement.setAttribute("data-theme", t);
        const m = document.getElementById("themeColorMeta");
        if (m) m.content = t === "dark" ? "#0a0a0f" : "#f0f2f8";
      })();
    </script>
  </head>

  <body>
    <!-- Background -->
    <div class="bg-mesh" aria-hidden="true"></div>

    <!-- Popover Menu -->
    <div class="popover-menu" id="popoverMenu" role="menu">
      <div class="popover-menu-header">Settings</div>
      <div class="popover-divider"></div>
      <div class="menu-item" onclick="toggleThemeSwitch(event)" role="menuitem">
        <div class="menu-item-left">
          <div
            class="menu-item-icon"
            style="
              background: color-mix(in srgb, var(--accent) 12%, transparent);
              color: var(--accent);
            "
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
            </svg>
          </div>
          <span>Dark Mode</span>
        </div>
        <label class="switch">
          <input type="checkbox" id="themeSwitch" onchange="toggleTheme()" />
          <span class="slider"></span>
        </label>
      </div>
      <div class="popover-divider"></div>
      <button class="menu-item" onclick="openInfoModal()" role="menuitem">
        <div class="menu-item-left">
          <div
            class="menu-item-icon"
            style="background: rgba(6, 182, 212, 0.12); color: #06b6d4"
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="16" x2="12" y2="12" />
              <line x1="12" y1="8" x2="12.01" y2="8" />
            </svg>
          </div>
          <span>About</span>
        </div>
        <svg
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2.5"
          stroke-linecap="round"
          stroke-linejoin="round"
          style="color: var(--text-muted)"
        >
          <polyline points="9 18 15 12 9 6" />
        </svg>
      </button>
    </div>

    <!-- Click-outside -->
    <div class="click-outside" id="clickOutside" onclick="toggleMenu()"></div>

    <!-- ── Sticky Header ── -->
    <header class="site-header">
      <div class="header-left" id="headerLeft">
        <!-- back btn injected per view by JS -->
        <a
          href="index.html"
          class="back-btn"
          id="mainBackBtn"
          aria-label="Back to home"
        >
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M19 12H5M12 19l-7-7 7-7" />
          </svg>
        </a>
        <div class="header-title-block">
          <div class="header-eyebrow" id="headerEyebrow">Education</div>
          <div class="header-title" id="headerTitle">Grade Calculator</div>
        </div>
      </div>

      <div class="header-actions">
        <!-- quick theme toggle -->
        <button
          class="icon-btn"
          onclick="quickToggleTheme()"
          aria-label="Toggle dark mode"
        >
          <svg
            id="themeIconSun"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="4" />
            <path
              d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"
            />
          </svg>
          <svg
            id="themeIconMoon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            style="display: none"
          >
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
          </svg>
        </button>

        <!-- Menu -->
        <div class="menu-wrapper">
          <button
            class="icon-btn"
            id="menuBtn"
            onclick="toggleMenu()"
            aria-label="Open menu"
            aria-expanded="false"
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="5" r="1" fill="currentColor" />
              <circle cx="12" cy="12" r="1" fill="currentColor" />
              <circle cx="12" cy="19" r="1" fill="currentColor" />
            </svg>
          </button>
        </div>
      </div>
    </header>

    <!-- ── VIEW 1: Course List ── -->
    <div class="dashboard" id="view-home">
      <div class="section-header">
        <span class="section-label">My Courses</span>
        <div class="section-line"></div>
        <span class="section-count" id="courseCount">6</span>
      </div>
      <div class="courses-grid" id="coursesGrid"></div>
    </div>

    <!-- ── VIEW 2: Calculator ── -->
    <div class="dashboard" id="view-calculator" style="display: none">
      <div class="score-display">
        <div class="course-code-pill" id="calcCourseCode">COURSE CODE</div>
        <div class="current-score" id="total">?</div>
        <div class="target-box" id="targetBox">
          <span id="target-msg">Enter marks to begin</span>
        </div>
      </div>

      <div class="section-header">
        <span class="section-label">Assessments</span>
        <div class="section-line"></div>
      </div>

      <div class="calc-grid" id="assessmentsGrid"></div>
    </div>

    <!-- Info Modal -->
    <div
      class="modal-overlay"
      id="infoModal"
      onclick="closeInfoModal(event)"
      role="dialog"
      aria-modal="true"
    >
      <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <rect x="4" y="2" width="16" height="20" rx="2" ry="2" />
            <line x1="8" y1="10" x2="16" y2="10" />
            <line x1="8" y1="14" x2="16" y2="14" />
            <line x1="8" y1="6" x2="12" y2="6" />
          </svg>
        </div>
        <div class="modal-version">v3.2</div>
        <h3 class="modal-title">Grade Calculator</h3>
        <p class="modal-text">
          Track your <strong>continuous assessments</strong> across all subjects
          and calculate exactly what you need to hit your target grade.<br /><br />
          <span style="font-size: 12px; color: var(--text-muted)"
            >© 2026 Azizi Yahya</span
          >
        </p>
        <button class="modal-btn" onclick="closeInfoModal(event)">
          Got it
        </button>
      </div>
    </div>

    <script>
      /* ── Theme helpers ───────────────────────────── */
      function applyThemeIcons(isDark) {
        document.getElementById("themeIconSun").style.display = isDark
          ? "none"
          : "";
        document.getElementById("themeIconMoon").style.display = isDark
          ? ""
          : "none";
        document.getElementById("themeColorMeta").content = isDark
          ? "#0a0a0f"
          : "#f0f2f8";
      }

      function toggleTheme() {
        const cb = document.getElementById("themeSwitch");
        const target = cb.checked ? "dark" : "light";
        document.documentElement.setAttribute("data-theme", target);
        localStorage.setItem("APP_THEME", target);
        applyThemeIcons(target === "dark");
      }

      function quickToggleTheme() {
        const isDark =
          document.documentElement.getAttribute("data-theme") === "dark";
        const target = isDark ? "light" : "dark";
        document.documentElement.setAttribute("data-theme", target);
        localStorage.setItem("APP_THEME", target);
        const cb = document.getElementById("themeSwitch");
        if (cb) cb.checked = !isDark;
        applyThemeIcons(!isDark);
      }

      function toggleThemeSwitch(event) {
        if (!event.target.closest(".switch")) {
          const cb = document.getElementById("themeSwitch");
          cb.checked = !cb.checked;
          toggleTheme();
        }
      }

      /* ── Menu helpers ────────────────────────────── */
      function toggleMenu() {
        const menu = document.getElementById("popoverMenu");
        const overlay = document.getElementById("clickOutside");
        const btn = document.getElementById("menuBtn");
        const isOpen = menu.classList.toggle("active");
        overlay.style.display = isOpen ? "block" : "none";
        btn.setAttribute("aria-expanded", isOpen);
        if (isOpen) {
          const rect = btn.getBoundingClientRect();
          menu.style.top = rect.bottom + 8 + "px";
          menu.style.right = window.innerWidth - rect.right + "px";
        }
      }

      function openInfoModal() {
        toggleMenu();
        document.getElementById("infoModal").classList.add("active");
      }

      function closeInfoModal(e) {
        if (e) e.stopPropagation();
        document.getElementById("infoModal").classList.remove("active");
      }

      /* ── Data / Config ───────────────────────────── */
      const STORAGE_KEY_OLD = "STUDENT_DASH_COMPACT";
      const STORAGE_KEY_MULTI = "MARKS_CALC_V2_DATA";
      const TARGET_GRADE = 80;

      const courses = [
        {
          id: "embedded",
          code: "NMT21305",
          name: "Embedded Systems",
          icon: "M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",
        },
        {
          id: "security",
          code: "NMT21403",
          name: "Network Security",
          icon: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
        },
        {
          id: "practices",
          code: "NMT21503",
          name: "Professional Practices",
          icon: "M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",
        },
        {
          id: "acquisition",
          code: "NMT21602",
          name: "Data Acquisition",
          icon: "M22 12h-4l-3 9L9 3l-3 9H2",
        },
        {
          id: "german",
          code: "SMB11802",
          name: "German Language",
          icon: "M5 8l6 6M4 14l6-6 2-3M2 5h12M7 2h1",
        },
        {
          id: "english",
          code: "SMB31202",
          name: "English Language",
          icon: "M4 6h16M4 12h16M4 18h12",
        },
      ];

      const courseConfigs = {
        embedded: [
          { id: "test", name: "Test", max: 20, weight: 20 },
          { id: "lab1", name: "Lab Test 1", max: 20, weight: 20 },
          { id: "lab2", name: "Lab Test 2", max: 20, weight: 20 },
          { id: "presentation", name: "MP Presentation", max: 20, weight: 15 },
          { id: "report", name: "MP Report", max: 15, weight: 15 },
          { id: "log", name: "Buku Log", max: 10, weight: 10 },
        ],
        security: [
          { id: "labtest1", name: "Lab Test 1", max: 15, weight: 15 },
          { id: "labtest2", name: "Lab Test 2", max: 15, weight: 15 },
          { id: "quiz1", name: "Quiz 1", max: 20, weight: 20 },
          { id: "quiz2", name: "Quiz 2", max: 20, weight: 20 },
          {
            id: "labassessment1",
            name: "Lab Assessment 1",
            max: 15,
            weight: 15,
          },
          {
            id: "labassessment2",
            name: "Lab Assessment 2",
            max: 15,
            weight: 15,
          },
          { id: "project", name: "Group Project", max: 50, weight: 50 },
        ],
        practices: [
          { id: "ex1", name: "Exercise 1", max: 10, weight: 10 },
          { id: "ex2", name: "Exercise 2", max: 10, weight: 10 },
          { id: "ex3", name: "Exercise 3", max: 10, weight: 10 },
          { id: "midterm", name: "Midterm Test", max: 30, weight: 30 },
          { id: "final", name: "Final Assessment", max: 40, weight: 40 },
        ],
        acquisition: [
          { id: "test", name: "Test", max: 20, weight: 20 },
          { id: "labreport", name: "Lab Report", max: 10, weight: 10 },
          { id: "labtest", name: "Lab Test", max: 20, weight: 20 },
          { id: "labwork", name: "Laboratory Work", max: 30, weight: 30 },
          {
            id: "pbl",
            name: "PBL (Project Based Learning)",
            max: 20,
            weight: 20,
          },
        ],
        german: [
          { id: "reading", name: "Reading Test", max: 20, weight: 20 },
          { id: "writing", name: "Writing Test", max: 20, weight: 20 },
          { id: "listening", name: "Listening Test", max: 30, weight: 30 },
          { id: "video", name: "Video Assignment", max: 30, weight: 30 },
        ],
        english: [
          {
            id: "assessment1",
            name: "Assessment 1 : Quiz",
            max: 30,
            weight: 30,
          },
          {
            id: "assessment2",
            name: "Assessment 2 : Poster",
            max: 40,
            weight: 40,
          },
          {
            id: "assessment3",
            name: "Assessment 3 : Group Discussion",
            max: 30,
            weight: 30,
          },
          { id: "poster", name: "Poster", max: 40, weight: 40 },
        ],
      };

      const defaultAssessments = [
        { id: "midterm", name: "Midterm", max: 40, weight: 40 },
        { id: "final", name: "Final", max: 60, weight: 60 },
      ];

      const bgClasses = {
        embedded: "embedded-bg",
        security: "security-bg",
        practices: "practices-bg",
        acquisition: "acquisition-bg",
        german: "german-bg",
        english: "english-bg",
      };

      let allMarksData = {};
      let currentCourseId = null;

      /* ── Init ─────────────────────────────────────── */
      document.addEventListener("DOMContentLoaded", () => {
        loadData();
        loadTheme();
        renderCourseList();
      });

      function loadData() {
        const raw = localStorage.getItem(STORAGE_KEY_MULTI);
        if (raw) {
          allMarksData = JSON.parse(raw);
        } else {
          const oldRaw = localStorage.getItem(STORAGE_KEY_OLD);
          if (oldRaw) {
            allMarksData["embedded"] = JSON.parse(oldRaw);
            localStorage.setItem(
              STORAGE_KEY_MULTI,
              JSON.stringify(allMarksData),
            );
          }
        }
      }

      function loadTheme() {
        const saved = localStorage.getItem("APP_THEME");
        const isDark = saved === "dark";
        if (saved) document.documentElement.setAttribute("data-theme", saved);
        const cb = document.getElementById("themeSwitch");
        if (cb) cb.checked = isDark;
        applyThemeIcons(isDark);
      }

      function getAssessments(courseId) {
        return courseConfigs[courseId] || defaultAssessments;
      }

      /* ── Navigation ───────────────────────────────── */
      function renderCourseList() {
        const grid = document.getElementById("coursesGrid");
        grid.innerHTML = "";

        courses.forEach((course, index) => {
          const card = document.createElement("div");
          const bgClass = bgClasses[course.id] || "";
          const isEnabled = course.id === "embedded";
          const courseMarks = allMarksData[course.id] || {};
          const assessments = getAssessments(course.id);

          let filledCount = 0,
            currentTotal = 0;
          assessments.forEach((a) => {
            const val = courseMarks[a.id];
            if (val && val !== "?" && !isNaN(parseFloat(val))) {
              filledCount++;
              currentTotal += (parseFloat(val) / a.max) * a.weight;
            }
          });

          const previewItems = assessments
            .slice(0, 2)
            .map((a) => {
              const val = courseMarks[a.id];
              const hasVal = val && val !== "?" && !isNaN(parseFloat(val));
              const valHtml = hasVal
                ? `<span class="preview-val">${Math.round((parseFloat(val) / a.max) * 100)}%</span>`
                : `<span class="badge-pending">Pending</span>`;
              return `<div class="preview-item"><span class="preview-item-name">${a.name}</span>${valHtml}</div>`;
            })
            .join("");

          card.className = `course-card ${bgClass}${isEnabled ? "" : " disabled"}`;
          card.style.animationDelay = `${index * 0.05}s`;
          card.innerHTML = `
          <div class="card-header">
            <div class="card-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                <path d="${course.icon}"/>
              </svg>
            </div>
            <div class="card-info">
              <div class="card-code">${course.code}</div>
              <div class="card-name">${course.name}</div>
            </div>
          </div>
          <div class="preview-section">
            <div class="preview-label">Recent</div>
            ${previewItems}
          </div>`;

          if (isEnabled) card.onclick = () => openCourse(course.id);
          grid.appendChild(card);
        });

        // reset header to home state
        document.getElementById("headerEyebrow").textContent = "Education";
        document.getElementById("headerTitle").textContent = "Grade Calculator";
        const backBtn = document.getElementById("mainBackBtn");
        backBtn.href = "index.html";
        backBtn.onclick = null;
      }

      function openCourse(courseId) {
        currentCourseId = courseId;
        const course = courses.find((c) => c.id === courseId);

        document.getElementById("view-home").style.display = "none";
        document.getElementById("view-calculator").style.display = "flex";

        document.getElementById("calcCourseCode").textContent =
          `${course.code} · ${course.name.toUpperCase()}`;

        // Update header
        document.getElementById("headerEyebrow").textContent = course.code;
        document.getElementById("headerTitle").textContent = course.name;
        const backBtn = document.getElementById("mainBackBtn");
        backBtn.removeAttribute("href");
        backBtn.onclick = (e) => {
          e.preventDefault();
          goHome();
        };

        renderCalculatorTiles();
        calculateScore();
        window.scrollTo(0, 0);
      }

      function goHome() {
        currentCourseId = null;
        document.getElementById("view-calculator").style.display = "none";
        document.getElementById("view-home").style.display = "flex";
        renderCourseList();
        window.scrollTo(0, 0);
      }

      /* ── Calculator ───────────────────────────────── */
      function renderCalculatorTiles() {
        const grid = document.getElementById("assessmentsGrid");
        grid.innerHTML = "";
        const items = getAssessments(currentCourseId);
        const marks = allMarksData[currentCourseId] || {};

        items.forEach((item, index) => {
          let val = marks[item.id] || "";
          if (val === "0" || val === 0) val = "";
          const tile = document.createElement("div");
          tile.className = "assessment-tile";
          tile.style.animationDelay = `${index * 0.05}s`;
          tile.innerHTML = `
          <div class="tile-header">
            <div class="tile-name">${item.name}</div>
            <div class="tile-weight">${item.weight}%</div>
          </div>
          <div class="input-area" onclick="document.getElementById('input-${item.id}').focus()">
            <input type="number"
              id="input-${item.id}"
              placeholder="?"
              value="${val}"
              oninput="updateMark('${item.id}', this.value, ${item.max})"
              onblur="validateMark('${item.id}', ${item.max})"
            >
            <span class="den">/${item.max}</span>
          </div>`;
          grid.appendChild(tile);
        });
      }

      function updateMark(assessId, value, max) {
        if (value === "" || value === "?") {
          saveAndRecalc(assessId, "");
          return;
        }
        let num = parseFloat(value);
        if (isNaN(num)) return;
        if (num < 0) {
          document.getElementById(`input-${assessId}`).value = "";
          saveAndRecalc(assessId, "");
          return;
        }
        if (num > max) {
          document.getElementById(`input-${assessId}`).value = max;
          saveAndRecalc(assessId, max);
          return;
        }
        saveAndRecalc(assessId, num);
      }

      function validateMark(assessId, max) {
        const input = document.getElementById(`input-${assessId}`);
        const value = input.value;
        if (value === "") {
          saveAndRecalc(assessId, "");
          return;
        }
        let num = parseFloat(value);
        if (isNaN(num) || num < 0) {
          input.value = "";
          saveAndRecalc(assessId, "");
          return;
        }
        if (num > max) {
          input.value = max;
          saveAndRecalc(assessId, max);
          return;
        }
        saveAndRecalc(assessId, num);
      }

      function saveAndRecalc(assessId, value) {
        if (!allMarksData[currentCourseId]) allMarksData[currentCourseId] = {};
        allMarksData[currentCourseId][assessId] = value;
        localStorage.setItem(STORAGE_KEY_MULTI, JSON.stringify(allMarksData));
        calculateScore();
      }

      function calculateScore() {
        let total = 0,
          enteredCount = 0,
          totalPossibleWeight = 0;
        const data = allMarksData[currentCourseId] || {};
        const assessments = getAssessments(currentCourseId);

        assessments.forEach((a) => {
          const val = data[a.id];
          if (
            val !== undefined &&
            val !== "" &&
            val !== "?" &&
            !isNaN(parseFloat(val))
          ) {
            const score = parseFloat(val);
            if (score >= 0 && score <= a.max) {
              enteredCount++;
              totalPossibleWeight += a.weight;
              total += (score / a.max) * a.weight;
            }
          }
        });
        updateDisplay(total, enteredCount, totalPossibleWeight);
      }

      function updateDisplay(total, enteredCount) {
        const totalEl = document.getElementById("total");
        const targetMsg = document.getElementById("target-msg");
        const targetBox = document.getElementById("targetBox");

        if (enteredCount === 0) {
          totalEl.textContent = "?";
          targetMsg.textContent = "Enter your marks to begin";
          targetBox.className = "target-box";
          return;
        }

        const display = total % 1 === 0 ? total.toFixed(0) : total.toFixed(1);
        totalEl.classList.remove("score-pulse");
        void totalEl.offsetWidth;
        totalEl.classList.add("score-pulse");
        totalEl.textContent = display;

        const diff = TARGET_GRADE - total;
        if (diff <= 0) {
          targetMsg.textContent = "🎉 Goal Reached! You've secured an A!";
        } else {
          let remainingPotential = 0;
          const data = allMarksData[currentCourseId] || {};
          const assessments = getAssessments(currentCourseId);
          assessments.forEach((a) => {
            const val = data[a.id];
            if (val === "?" || val === "" || val === undefined) {
              remainingPotential += a.weight;
            } else if (!isNaN(parseFloat(val))) {
              const score = parseFloat(val);
              if (score < a.max)
                remainingPotential += ((a.max - score) / a.max) * a.weight;
            }
          });
          targetMsg.textContent =
            remainingPotential >= diff
              ? `Need ${diff.toFixed(1)}% more for an A`
              : `Aim high in remaining items & final exam`;
        }
      }

      function updateInputColors() {
        /* no-op, kept for compat */
      }

      window.addEventListener("storage", (e) => {
        if (e.key === "APP_THEME") {
          const isDark = e.newValue === "dark";
          document.documentElement.setAttribute("data-theme", e.newValue);
          const cb = document.getElementById("themeSwitch");
          if (cb) cb.checked = isDark;
          applyThemeIcons(isDark);
        }
      });
    </script>
  </body>
</html>
