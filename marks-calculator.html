<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal Student Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* =========================================
           1. DESIGN TOKENS
           ========================================= */
      :root {
        /* Palette: Emerald & Charcoal */
        --bg-body: #fdfdfd;
        --bg-card: #ffffff;
        --bg-input: #f4f4f5;

        --primary: #10b981;
        /* Emerald 500 */
        --primary-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
        --primary-glow: rgba(16, 185, 129, 0.3);

        --text-main: #18181b;
        --text-sec: #71717a;
        --border: #e4e4e7;

        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;

        --radius-lg: 24px;
        --radius-md: 16px;
        --radius-sm: 12px;

        --shadow-soft: 0 4px 20px -5px rgba(0, 0, 0, 0.05);
        --shadow-hover: 0 10px 25px -5px rgba(16, 185, 129, 0.15);

        --btn-bg: rgba(255, 255, 255, 0.9);
      }

      [data-theme="dark"] {
        --bg-body: #09090b;
        /* Zinc 950 */
        --bg-card: #18181b;
        /* Zinc 900 */
        --bg-input: #27272a;
        /* Zinc 800 */

        --primary: #34d399;
        --primary-gradient: linear-gradient(135deg, #34d399 0%, #10b981 100%);
        --primary-glow: rgba(52, 211, 153, 0.2);

        --text-main: #fafafa;
        --text-sec: #a1a1aa;
        --border: #27272a;

        --btn-bg: rgba(58, 58, 60, 0.9);
      }

      /* =========================================
           2. CORE LAYOUT (NO SCROLL)
           ========================================= */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Plus Jakarta Sans", sans-serif;
      }

      html,
      body {
        width: 100%;
        min-height: 100vh;
        overflow-x: hidden;
        overflow-y: auto;
      }

      body {
        background: var(--bg-body);
        color: var(--text-main);
        transition: all 0.3s ease;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 20px 0;
      }

      .dashboard {
        width: 100%;
        max-width: 480px;
        /* Mobile Default */
        height: auto;
        padding: 0px 16px 20px 16px;
        /* Tightened padding */
        display: flex;
        flex-direction: column;
        gap: 10px;
        /* Reduced gap */
        background: var(--bg-body);
      }

      /* Animations */
      @keyframes slideInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* =========================================
           3. COMPONENTS
           ========================================= */

      /* --- Header --- */
      /* --- Header --- */
      .header {
        position: relative;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 4px;
        flex-shrink: 0;
        animation: slideInDown 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        margin-bottom: 4px;
        /* Reduced margin */
      }

      .back-btn {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 50%;
        text-decoration: none;
        color: var(--text-main);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
      }

      .back-btn:hover {
        transform: scale(1.1);
        background: var(--bg-input);
        border-color: var(--primary);
      }

      .back-btn:active {
        transform: scale(0.95);
        transition: all 0.1s ease;
      }

      .brand {
        text-align: center;
        margin: 0;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
      }

      .brand h2 {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        color: var(--primary);
        font-weight: 800;
        margin-bottom: 2px;
      }

      .brand p {
        font-size: 1.5rem;
        /* Larger Title */
        font-weight: 800;
        color: var(--text-main);
        line-height: 1;
      }

      /* --- Score Card --- */
      /* --- Score Card --- */
      .score-display {
        background: var(--primary-gradient);
        border-radius: var(--radius-lg);
        padding: 24px;
        /* Improved padding */
        animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.1s backwards;
        text-align: center;
        color: white;
        box-shadow: 0 10px 30px -5px var(--primary-glow);
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        min-height: 170px;
        /* improved height */
        gap: 12px;
        /* Increased gap */
      }

      .score-display::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle at top right,
          rgba(255, 255, 255, 0.2),
          transparent 70%
        );
        pointer-events: none;
      }

      .course-code {
        font-size: 0.65rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: rgba(0, 0, 0, 0.15);
        color: rgba(255, 255, 255, 0.9);
        padding: 6px 14px;
        border-radius: 20px;
        margin-bottom: 0;
        /* Let flex gap handle spacing */
      }

      .current-score {
        font-size: 3rem;
        /* Slightly smaller */
        /* Large Font again */
        font-weight: 800;
        line-height: 1;
        letter-spacing: -2px;
        margin: 0;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        animation: scoreReveal 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      @keyframes scoreReveal {
        from {
          transform: scale(0.8);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .score-pulse {
        animation: scorePulse 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      @keyframes scorePulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      .target-box {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50px;
        padding: 8px 18px;
        font-size: 0.85rem;
        font-weight: 700;
        backdrop-filter: blur(4px);
        margin: 0;
        display: inline-flex;
        align-items: center;
        color: white;
      }

      /* --- Grid & Tiles --- */
      .calc-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        /* Further compacted */
      }

      .calc-grid::-webkit-scrollbar {
        display: none;
      }

      /* Hide Scrollbar visually but allow scroll */
      .calc-grid::-webkit-scrollbar {
        width: 4px;
      }

      .calc-grid::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 4px;
      }

      .assessment-tile {
        background: var(--bg-card);
        border: 1px solid transparent;
        /* No border */
        border-radius: var(--radius-lg);
        /* Larger radius */
        padding: 14px;
        /* Compact padding */
        /* Optimized padding */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 8px;
        /* Reduced gap */
        box-shadow: var(--shadow-soft);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        min-height: 110px;
        /* Compact Height */
        /* Optimized height */
        overflow: hidden;
      }

      .assessment-tile:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
        border-color: var(--border);
      }

      .assessment-tile:active {
        transform: translateY(0px) scale(0.98);
        transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Remove pseudo-element status bar to match image */
      .assessment-tile::before {
        display: none;
      }

      .tile-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }

      .tile-name {
        font-size: 1rem;
        /* Larger Title */
        font-weight: 800;
        color: var(--text-sec);
        /* Grayish */
        line-height: 1.2;
      }

      .tile-weight {
        font-size: 0.8rem;
        font-weight: 800;
        background: transparent;
        color: var(--text-sec);
        opacity: 0.6;
        padding: 0;
      }

      .input-area {
        background: var(--bg-input);
        border-radius: 12px;
        /* Adjusted radius */
        /* Soft rec pill */
        padding: 8px 12px;
        /* Compact pill */
        display: flex;
        align-items: center;
        /* Center vertically */
        justify-content: space-between;
        margin-top: auto;
        transition: all 0.2s ease;
      }

      .input-area:focus-within {
        background: var(--bg-card);
        box-shadow: 0 0 0 2px var(--primary);
        transform: scale(1.02);
      }

      input {
        width: 100%;
        background: transparent;
        border: none;
        outline: none;
        font-size: 1.4rem;
        /* Adjusted Score Size */
        /* Very Large Number */
        font-weight: 800;
        color: var(--text-main);
        padding: 0;
        font-variant-numeric: tabular-nums;
        line-height: 1;
        transition: color 0.2s ease;
      }

      input:focus {
        color: var(--primary);
      }

      .den {
        font-size: 1rem;
        color: var(--text-sec);
        font-weight: 700;
        opacity: 0.6;
      }

      /* Remove old status classes styling since we removed the bar */
      .assessment-tile.status-good,
      .assessment-tile.status-warning,
      .assessment-tile.status-danger {
        /* No border color change */
      }

      /* --- Course Card (New) --- */
      /* --- Course Card (New) --- */
      .course-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        padding: 14px;
        /* Slightly tighter */
        display: flex;
        flex-direction: column;
        gap: 8px;
        /* Reduced gap */
        box-shadow: var(--shadow-soft);
        transition: all 0.2s ease;
        cursor: pointer;
        min-height: auto;
        /* Let content dictate height */
        justify-content: flex-start;
        animation: fadeIn 0.5s ease backwards;
      }

      .course-card:hover {
        box-shadow: var(--shadow-hover);
        border-color: var(--primary);
        transform: translateY(-2px);
      }

      .course-card.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        position: relative;
        filter: grayscale(0.3);
      }

      .course-card.disabled::after {
        content: "Coming Soon";
        position: absolute;
        top: 12px;
        right: 12px;
        background: var(--text-sec);
        color: var(--bg-card);
        font-size: 0.65rem;
        font-weight: 700;
        padding: 4px 10px;
        border-radius: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        opacity: 0.8;
      }

      .course-card.disabled:hover {
        box-shadow: var(--shadow-soft);
        border-color: var(--border);
        transform: none;
      }

      .card-header {
        display: flex;
        align-items: flex-start;
        /* Align top to match code level */
        margin-bottom: 4px;
        /* Reduced margin */
      }

      .course-icon {
        /* Keeping generic for fallback, but main is .subject-icon */
        width: 36px;
        /* Reduced size */
        height: 32px;
        background: var(--bg-input);
        border-radius: 50%;
        display: grid;
        place-items: center;
        color: var(--primary);
        font-size: 1rem;
        margin-bottom: 0;
      }

      .subject-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .subject-code {
        font-size: 0.65rem;
        /* Slight reduction */
        color: var(--text-sec);
        font-weight: 700;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        margin-bottom: 4px;
        line-height: 1;
      }

      .subject-name {
        font-size: 0.85rem;
        /* Reduced font size */
        font-weight: 800;
        color: var(--text-main);
        line-height: 1.1;
        /* Tighter line height */
      }

      /* Subject Icons */
      .subject-icon {
        width: 32px;
        /* Reduced size */
        height: 32px;
        border-radius: 8px;
        /* Slightly smaller radius */
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        color: white;
        flex-shrink: 0;
        margin-right: 8px;
        /* Reduced margin */
      }

      .embedded-bg {
        background: linear-gradient(135deg, #5b6bf0, #8a94ff);
      }

      .security-bg {
        background: linear-gradient(135deg, #00c896, #00e5a8);
      }

      .practices-bg {
        background: linear-gradient(135deg, #ff9f43, #ffb36b);
      }

      .acquisition-bg {
        background: linear-gradient(135deg, #9d4edd, #b57eed);
      }

      .german-bg {
        background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
      }

      .english-bg {
        background: linear-gradient(135deg, #4895ef, #6ba7f0);
      }

      .course-card .progress-pill {
        align-self: flex-start;
        font-size: 0.7rem;
        font-weight: 700;
        padding: 3px 8px;
        border-radius: 20px;
        background: var(--bg-input);
        color: var(--text-sec);
      }

      .course-card.active .progress-pill {
        background: var(--primary-glow);
        color: var(--primary);
      }

      /* Preview Section in Card */
      .preview-section {
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px solid var(--border);
      }

      .preview-header {
        font-size: 0.75rem;
        color: var(--text-sec);
        font-weight: 600;
        margin-bottom: 8px;
      }

      .preview-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
        margin-bottom: 6px;
        color: var(--text-main);
      }

      .preview-item:last-child {
        margin-bottom: 0;
      }

      .preview-val {
        font-weight: 700;
      }

      .badge-pending {
        background: var(--bg-input);
        color: var(--text-sec);
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 6px;
        font-weight: 600;
        font-style: italic;
      }

      /* =========================================
           4. DESKTOP CENTERED CARD (MOBILE LOOK)
           ========================================= */
      @media (min-width: 800px) {
        .dashboard {
          max-width: 480px;
          margin: 40px auto;

          /* Phone Card Look */
          background: var(--bg-card);
          border-radius: 32px;
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
          border: 1px solid var(--border);
          padding: 32px 24px;

          /* Force Vertical Stack */
          display: flex;
          flex-direction: column;
          gap: 24px;

          height: auto;
        }

        /* Reset Overrides */
        #view-home.dashboard,
        #view-calculator.dashboard {
          display: flex;
          min-height: auto;
        }

        .dashboard {
          height: auto;
          max-height: 90vh;
          /* Don't fill full screen on desktop */
          margin: auto;
          border-radius: 32px;
        }

        #view-home .courses-grid {
          grid-template-columns: repeat(2, 1fr);
          margin-top: 0;
          gap: 12px;
          overflow-y: auto;
          /* Maintain scroll */
        }

        /* Ensure header/score do not grid positions */
        .header,
        .score-display,
        .calc-grid {
          margin: 0;
          flex-shrink: 0;
        }

        .calc-grid {
          overflow-y: auto;
          flex: 1;
          grid-column: auto;
          grid-row: auto;
          height: auto;
          padding: 0;
          grid-template-columns: repeat(2, 1fr);
        }
      }

      /* Menu */
      .menu-btn {
        position: absolute;
        right: 0px;
        top: 50%;
        transform: translateY(-50%);
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        color: var(--text-main);
        background: var(--btn-bg);
        cursor: pointer;
        border: 1px solid var(--border);
        transition: background 0.2s;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        z-index: 1002;
      }

      .menu-btn:hover,
      .menu-btn.active {
        background: var(--bg-input);
        color: var(--text-main);
      }

      .popover-menu {
        position: absolute;
        top: 60px;
        right: 20px;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.2);
        padding: 8px;
        width: 220px;
        display: none;
        flex-direction: column;
        gap: 4px;
        z-index: 100;
        animation: fadeIn 0.2s ease forwards;
        transform-origin: top right;
      }

      .popover-menu.active {
        display: flex;
      }

      .menu-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: background 0.2s;
        color: var(--text-main);
        font-size: 0.9rem;
        font-weight: 600;
        text-decoration: none;
        border: none;
        background: transparent;
        width: 100%;
        text-align: left;
      }

      .menu-item:hover {
        background: var(--bg-input);
      }

      /* Toggle Switch */
      .switch {
        position: relative;
        width: 44px;
        height: 24px;
        flex-shrink: 0;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--bg-input);
        border: 2px solid var(--border);
        transition: 0.3s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 2px;
        bottom: 2px;
        background-color: var(--text-sec);
        transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: var(--primary);
        border-color: var(--primary);
      }

      input:checked + .slider:before {
        transform: translateX(20px);
        background-color: white;
      }

      /* Modal Overlay */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .modal-overlay.active {
        display: flex;
        opacity: 1;
      }

      .modal-card {
        background: var(--bg-card);
        padding: 32px;
        border-radius: var(--radius-lg);
        max-width: 400px;
        width: 100%;
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.3);
        border: 1px solid var(--border);
        transform: translateY(20px);
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        text-align: center;
      }

      .modal-overlay.active .modal-card {
        transform: translateY(0);
      }

      .modal-title {
        font-size: 1.5rem;
        font-weight: 800;
        margin-bottom: 12px;
        color: var(--text-main);
      }

      .modal-text {
        color: var(--text-sec);
        line-height: 1.6;
        font-size: 0.95rem;
        margin-bottom: 24px;
      }

      .modal-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 12px 32px;
        border-radius: var(--radius-md);
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 0.2s;
        width: 100%;
      }

      .modal-btn:active {
        transform: scale(0.96);
      }

      .click-outside {
        position: fixed;
        inset: 0;
        z-index: 90;
        display: none;
      }
    </style>
  </head>

  <body data-theme="light">
    <div class="click-outside" id="clickOutside" onclick="toggleMenu()"></div>

    <!-- VIEW 1: COURSE LIST -->
    <div class="dashboard" id="view-home">
      <div class="header">
        <a href="index.html" class="back-btn">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M19 12H5M12 19l-7-7 7-7" />
          </svg>
        </a>
        <div class="brand">
          <h2>Student Dashboard</h2>
          <p>My Courses</p>
        </div>
        <button class="menu-btn" onclick="toggleMenu()">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="1"></circle>
            <circle cx="19" cy="12" r="1"></circle>
            <circle cx="5" cy="12" r="1"></circle>
          </svg>
        </button>
      </div>

      <div class="calc-grid courses-grid" id="coursesGrid">
        <!-- Course Cards Generated Here -->
      </div>
    </div>

    <!-- VIEW 2: CALCULATOR -->
    <div class="dashboard" id="view-calculator" style="display: none">
      <!-- Header -->
      <div class="header">
        <div class="back-btn" onclick="goHome()">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M19 12H5M12 19l-7-7 7-7" />
          </svg>
        </div>
        <div class="brand">
          <h2>Marks Calculator</h2>
          <p>Details</p>
        </div>
        <button class="menu-btn" onclick="toggleMenu()">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="1"></circle>
            <circle cx="19" cy="12" r="1"></circle>
            <circle cx="5" cy="12" r="1"></circle>
          </svg>
        </button>
      </div>

      <!-- Score Display -->
      <div class="score-display">
        <div class="course-code" id="calcCourseCode">COURSE CODE</div>
        <div class="current-score" id="total">?</div>
        <div class="target-box" id="targetBox">
          <div id="target-msg">Enter marks</div>
        </div>
      </div>

      <!-- Assessment Grid -->
      <div class="calc-grid" id="assessmentsGrid">
        <!-- Tiles Generated Here -->
      </div>
    </div>

    <!-- Shared Popover Menu -->
    <div class="popover-menu" id="popoverMenu">
      <div class="menu-item" onclick="toggleThemeSwitch(event)">
        <span>Dark Mode</span>
        <label class="switch">
          <input type="checkbox" id="themeSwitch" onchange="toggleTheme()" />
          <span class="slider"></span>
        </label>
      </div>
      <button class="menu-item" onclick="openInfoModal()">
        <span>Info</span>
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
      </button>
    </div>

    <!-- Info Modal -->
    <div class="modal-overlay" id="infoModal" onclick="closeInfoModal(event)">
      <div class="modal-card" onclick="event.stopPropagation()">
        <h3 class="modal-title">About</h3>
        <p class="modal-text">
          <strong>Grade Calculator</strong><br />
          v3.1 Multi-Course<br /><br />
          Track your continuous assessments for all your subjects and calculate
          exactly what you need to achieve your target grade.
          <br /><br />
          <span style="font-size: 0.8rem; opacity: 0.7"
            >Â© 2026 Azizi Yahya</span
          >
        </p>
        <button class="modal-btn" onclick="closeInfoModal(event)">
          Got it
        </button>
      </div>
    </div>

    <script>
      // Configuration
      const STORAGE_KEY_OLD = "STUDENT_DASH_COMPACT";
      const STORAGE_KEY_MULTI = "MARKS_CALC_V2_DATA";
      const TARGET_GRADE = 80; // Grade A target

      // Course Definitions
      const courses = [
        {
          id: "embedded",
          code: "NMT21305",
          name: "Embedded Systems",
          icon: "book",
        },
        {
          id: "security",
          code: "NMT21403",
          name: "Network Security",
          icon: "shield-alt",
        },
        {
          id: "practices",
          code: "NMT21503",
          name: "Professional Practices",
          icon: "briefcase",
        },
        {
          id: "acquisition",
          code: "NMT21602",
          name: "Data Acquisition",
          icon: "database",
        },
        {
          id: "german",
          code: "SMB11802",
          name: "German Language",
          icon: "language",
        },
        {
          id: "english",
          code: "SMB31202",
          name: "English Language",
          icon: "book",
        },
      ];

      // Specific Assessment Structures per Course (Customized as requested)
      const courseConfigs = {
        // Original: 3 Labs, 1 Test, 2 Project
        embedded: [
          { id: "test", name: "Test", max: 20, weight: 20 },
          { id: "lab1", name: "Lab Test 1", max: 20, weight: 20 },
          { id: "lab2", name: "Lab Test 2", max: 20, weight: 20 },
          { id: "presentation", name: "MP Presentation", max: 20, weight: 15 },
          { id: "report", name: "MP Report", max: 15, weight: 15 },
          { id: "log", name: "Buku Log", max: 10, weight: 10 },
        ],
        // Security: 2 Tests, 2 Labs, Final
        security: [
          { id: "labtest1", name: "Lab Test 1", max: 15, weight: 15 },
          { id: "labtest2", name: "Lab Test 2", max: 15, weight: 15 },
          { id: "quiz1", name: "Quiz 1", max: 20, weight: 20 },
          { id: "quiz2", name: "Quiz 2", max: 20, weight: 20 },
          {
            id: "labassessment1",
            name: "Lab Assessment 1",
            max: 15,
            weight: 15,
          },
          {
            id: "labassessment2",
            name: "Lab Assessment 2",
            max: 15,
            weight: 15,
          },
          { id: "project", name: "Group Project", max: 50, weight: 50 },
        ],
        // Practices: Multiple Exercises
        practices: [
          { id: "ex1", name: "Exercise 1", max: 10, weight: 10 },
          { id: "ex2", name: "Exercise 2", max: 10, weight: 10 },
          { id: "ex3", name: "Exercise 3", max: 10, weight: 10 },
          { id: "midterm", name: "Midterm Test", max: 30, weight: 30 },
          { id: "final", name: "Final Assessment", max: 40, weight: 40 },
        ],
        // Acquisition: Test, Lab Report, Lab Test, Laboratory Work, PBL
        acquisition: [
          { id: "test", name: "Test", max: 20, weight: 20 },
          { id: "labreport", name: "Lab Report", max: 10, weight: 10 },
          { id: "labtest", name: "Lab Test", max: 20, weight: 20 },
          { id: "labwork", name: "Laboratory Work", max: 30, weight: 30 },
          {
            id: "pbl",
            name: "PBL (Project Based Learning)",
            max: 20,
            weight: 20,
          },
        ],
        // Languages: Listening/Oral/Writing
        german: [
          { id: "reading", name: "Reading Test", max: 20, weight: 20 },
          { id: "writing", name: "Writing Test", max: 20, weight: 20 },
          { id: "listening", name: "Listening Test", max: 30, weight: 30 },
          { id: "video", name: "Video Assignment", max: 30, weight: 30 },
        ],
        english: [
          {
            id: "assessment1",
            name: "Assessment 1 : Quiz",
            max: 30,
            weight: 30,
          },
          {
            id: "assessment2",
            name: "Assessment 2 : Poster",
            max: 40,
            weight: 40,
          },
          {
            id: "assessment3",
            name: "Assessment 3 : Group Discussion",
            max: 30,
            weight: 30,
          },
          { id: "poster", name: "Poster", max: 40, weight: 40 },
        ],
      };

      // Fallback
      const defaultAssessments = [
        { id: "midterm", name: "Midterm", max: 40, weight: 40 },
        { id: "final", name: "Final", max: 60, weight: 60 },
      ];

      // State
      let allMarksData = {};
      let currentCourseId = null;

      // =========================================
      // INITIALIZATION
      // =========================================
      document.addEventListener("DOMContentLoaded", () => {
        loadData();
        loadTheme();
        renderCourseList();
      });

      function loadData() {
        const raw = localStorage.getItem(STORAGE_KEY_MULTI);
        if (raw) {
          allMarksData = JSON.parse(raw);
        } else {
          // Migration Check
          const oldRaw = localStorage.getItem(STORAGE_KEY_OLD);
          if (oldRaw) {
            // Migrate old data to 'embedded'
            allMarksData["embedded"] = JSON.parse(oldRaw);
            // Save immediately
            localStorage.setItem(
              STORAGE_KEY_MULTI,
              JSON.stringify(allMarksData),
            );
          }
        }
      }

      function loadTheme() {
        const savedTheme = localStorage.getItem("APP_THEME");
        const themeSwitch = document.getElementById("themeSwitch");
        if (savedTheme) {
          document.documentElement.setAttribute("data-theme", savedTheme);
          if (savedTheme === "dark") themeSwitch.checked = true;
        }
      }

      function getAssessments(courseId) {
        return courseConfigs[courseId] || defaultAssessments;
      }

      // =========================================
      // VIEW NAVIGATION
      // =========================================
      function renderCourseList() {
        const grid = document.getElementById("coursesGrid");
        grid.innerHTML = "";

        courses.forEach((course, index) => {
          const card = document.createElement("div");
          card.className = "course-card";
          card.style.animationDelay = index * 0.05 + "s";

          // Calculate progress for this course
          const courseMarks = allMarksData[course.id] || {};
          const assessments = getAssessments(course.id);

          let filledCount = 0;
          let currentTotal = 0; // Weighted Sum

          assessments.forEach((a) => {
            const val = courseMarks[a.id];
            if (val && val !== "?" && !isNaN(parseFloat(val))) {
              filledCount++;
              const score = parseFloat(val);
              currentTotal += (score / a.max) * a.weight;
            }
          });

          const displayScore =
            filledCount > 0 ? currentTotal.toFixed(0) + "%" : "Start";

          const bgClass = `${course.id}-bg`;

          // Check if this course should be enabled (only embedded for now)
          const isEnabled = course.id === "embedded";

          // Get first 2 items for preview
          const previewItems = assessments
            .slice(0, 2)
            .map((a) => {
              const val = courseMarks[a.id];
              let valDisplay = "";

              if (val && val !== "?" && !isNaN(parseFloat(val))) {
                const score = parseFloat(val);
                const pct = Math.round((score / a.max) * 100);
                valDisplay = `<span class="preview-val">${pct}%</span>`;
              } else {
                valDisplay = `<span class="badge-pending">Pending</span>`;
              }

              return `
                        <div class="preview-item">
                            <span>${a.name}</span>
                            ${valDisplay}
                        </div>
                    `;
            })
            .join("");

          card.innerHTML = `
                    <div class="card-header">
                        <div class="subject-icon ${bgClass}">
                           <i class="fas fa-${course.icon}"></i>
                        </div>
                        <div class="subject-info">
                           <div class="subject-code">${course.code}</div>
                           <div class="subject-name">${course.name}</div>
                        </div>
                    </div>
                    
                    <div class="preview-section">
                        <div class="preview-header">Recent</div>
                        ${previewItems}
                    </div>
                `;

          // Add disabled class if not enabled
          if (!isEnabled) {
            card.classList.add("disabled");
          }

          // Only make it clickable if enabled
          if (isEnabled) {
            card.onclick = () => openCourse(course.id);
          }

          grid.appendChild(card);
        });
      }

      function openCourse(courseId) {
        currentCourseId = courseId;
        const course = courses.find((c) => c.id === courseId);

        // Switch Views
        document.getElementById("view-home").style.display = "none";
        document.getElementById("view-calculator").style.display = "flex";

        // Update Header
        document.getElementById("calcCourseCode").textContent =
          `${course.code} ${course.name.toUpperCase()}`;

        // Render Tiles
        renderCalculatorTiles();

        // Calculate
        calculateScore();

        // Scroll to top
        window.scrollTo(0, 0);
      }

      function goHome() {
        currentCourseId = null;
        document.getElementById("view-calculator").style.display = "none";
        document.getElementById("view-home").style.display = "flex"; // Restore flex
        renderCourseList(); // Re-render to update scores
        window.scrollTo(0, 0);
      }

      // =========================================
      // CALCULATOR LOGIC
      // =========================================
      function renderCalculatorTiles() {
        const grid = document.getElementById("assessmentsGrid");
        grid.innerHTML = "";

        const savedMarks = allMarksData[currentCourseId] || {};
        const assessments = getAssessments(currentCourseId);

        assessments.forEach((assess, index) => {
          const val =
            savedMarks[assess.id] !== undefined ? savedMarks[assess.id] : "?";

          const tile = document.createElement("div");
          tile.className = "assessment-tile";
          tile.style.animationDelay = index * 0.05 + "s";
          tile.onclick = () => focusInput(assess.id);

          tile.innerHTML = `
                    <div class="tile-header">
                        <span class="tile-name">${assess.name}</span>
                        <span class="tile-weight">${assess.weight}%</span>
                    </div>
                    <div class="input-area">
                        <input type="number" id="${assess.id}" placeholder="?" 
                            value="${val === "?" ? "" : val}"
                            oninput="validateAndCalculate(this, '${assess.id}', ${assess.max})"
                            onfocus="handleFocus(this)" 
                            onblur="handleBlur(this, ${assess.max})">
                        <span class="den">/${assess.max}</span>
                    </div>
                `;
          grid.appendChild(tile);

          // Initialize blur state (restore ? if empty)
          if (val === "?" || val === "") {
            tile.querySelector("input").value = "?"; // Visual only
          }
        });
      }

      function validateAndCalculate(input, assessId, max) {
        let value = input.value;

        // If empty or ?, skip validation but recalc
        if (value === "" || value === "?") {
          saveAndRecalc(assessId, "?");
          return;
        }

        let numValue = parseFloat(value);
        if (isNaN(numValue)) {
          input.value = "";
          saveAndRecalc(assessId, "?");
          return;
        }
        if (numValue < 0) {
          input.value = "";
          saveAndRecalc(assessId, "?");
          return;
        }
        if (numValue > max) {
          input.value = max;
          numValue = max;
          // Note: we don't update input.value here to let user type freely, capped on blur/re-render
        }

        saveAndRecalc(assessId, numValue);
      }

      function saveAndRecalc(assessId, value) {
        // Update State
        if (!allMarksData[currentCourseId]) {
          allMarksData[currentCourseId] = {};
        }
        allMarksData[currentCourseId][assessId] = value;

        // Save to LocalStorage
        localStorage.setItem(STORAGE_KEY_MULTI, JSON.stringify(allMarksData));

        calculateScore();
      }

      function handleFocus(input) {
        if (input.value === "?") {
          input.value = "";
        }
      }

      function handleBlur(input, max) {
        let value = input.value;
        if (value === "" || isNaN(parseFloat(value))) {
          input.value = "?";
          saveAndRecalc(input.id, "?");
        } else if (parseFloat(value) > max) {
          input.value = max;
          saveAndRecalc(input.id, max);
        }
        calculateScore();
      }

      function focusInput(id) {
        const input = document.getElementById(id);
        if (input) {
          input.focus();
          setTimeout(() => {
            if (input.value !== "?") input.select();
          }, 50);
        }
      }

      function renderCalculatorTiles() {
        const grid = document.getElementById("assessmentsGrid");
        grid.innerHTML = "";

        const items = getAssessments(currentCourseId);
        const marks = allMarksData[currentCourseId] || {};

        items.forEach((item, index) => {
          let val = marks[item.id] || "";
          if (val === "0" || val === 0) val = ""; // Treat 0 as empty so ? placeholder shows
          const tile = document.createElement("div");
          tile.className = "assessment-tile";

          // No status classes or borders needed

          // Stagger animate
          tile.style.animationDelay = `${index * 0.05}s`;

          tile.innerHTML = `
                    <div class="tile-header">
                        <div class="tile-name">${item.name}</div>
                        <div class="tile-weight">${item.weight}%</div>
                    </div>
                    
                    <div class="input-area" onclick="document.getElementById('input-${item.id}').focus()">
                        <input type="number" 
                            id="input-${item.id}"
                            placeholder="?" 
                            value="${val}" 
                            oninput="updateMark('${item.id}', this.value, ${item.max});"
                        >
                        <span class="den">/${item.max}</span>
                    </div>
                `;
          grid.appendChild(tile);
        });
        updateInputColors(); // Ensure colors correct on load
      }

      function calculateScore() {
        let total = 0;
        let enteredCount = 0;
        let totalPossibleWeight = 0;

        const currentData = allMarksData[currentCourseId] || {};
        const assessments = getAssessments(currentCourseId);

        assessments.forEach((assess) => {
          const val = currentData[assess.id];
          if (
            val !== undefined &&
            val !== "" &&
            val !== "?" &&
            !isNaN(parseFloat(val))
          ) {
            let score = parseFloat(val);
            if (score >= 0 && score <= assess.max) {
              enteredCount++;
              totalPossibleWeight += assess.weight;
              total += (score / assess.max) * assess.weight;
            }
          }
        });

        updateDisplay(total, enteredCount, totalPossibleWeight);
      }

      function updateDisplay(total, enteredCount, totalPossibleWeight) {
        const totalEl = document.getElementById("total");
        const targetMsg = document.getElementById("target-msg");
        const targetBox = document.getElementById("targetBox");

        if (enteredCount === 0) {
          totalEl.textContent = "?";
          targetMsg.textContent = "Enter your marks to begin";
          targetBox.className = "target-box";
          updateInputColors();
          return;
        }

        const displayScore =
          total % 1 === 0 ? total.toFixed(0) : total.toFixed(1);

        // Trigger pulse animation on score change
        totalEl.classList.remove("score-pulse");
        void totalEl.offsetWidth; // Force reflow
        totalEl.classList.add("score-pulse");

        totalEl.textContent = displayScore;

        const diff = TARGET_GRADE - total;

        if (diff <= 0) {
          targetMsg.textContent = "ðŸŽ‰ Goal Reached! You've secured an A!";
          targetBox.className = "target-box success";
        } else {
          let remainingPotential = 0;
          const currentData = allMarksData[currentCourseId] || {};
          const assessments = getAssessments(currentCourseId);

          assessments.forEach((assess) => {
            const val = currentData[assess.id];
            if (val === "?" || val === "" || val === undefined) {
              remainingPotential += assess.weight;
            } else if (!isNaN(parseFloat(val))) {
              const score = parseFloat(val);
              if (score < assess.max) {
                const potentialIncrease = assess.max - score;
                remainingPotential +=
                  (potentialIncrease / assess.max) * assess.weight;
              }
            }
          });

          if (remainingPotential >= diff) {
            targetMsg.textContent = `Need ${diff.toFixed(1)}% more for an A`;
            targetBox.className = "target-box";
          } else {
            targetMsg.textContent = `Aim high in remaining items & final exam`;
            targetBox.className = "target-box";
          }
        }

        updateInputColors();
      }

      function updateInputColors() {
        // Function kept to avoid reference errors, but logic removed as per user request.
      }

      // =========================================
      // UI INTERACTIONS
      // =========================================
      function toggleMenu() {
        const menu = document.getElementById("popoverMenu");
        const overlay = document.getElementById("clickOutside");
        document
          .querySelectorAll(".menu-btn")
          .forEach((b) => b.classList.toggle("active"));

        menu.classList.toggle("active");
        overlay.style.display = menu.classList.contains("active")
          ? "block"
          : "none";
      }

      function openInfoModal() {
        toggleMenu();
        document.getElementById("infoModal").classList.add("active");
      }

      function closeInfoModal(e) {
        if (e) e.stopPropagation();
        document.getElementById("infoModal").classList.remove("active");
      }

      function toggleThemeSwitch(event) {
        if (!event.target.closest(".switch")) {
          const checkbox = document.getElementById("themeSwitch");
          checkbox.checked = !checkbox.checked;
          toggleTheme();
        }
      }

      function toggleTheme() {
        const checkbox = document.getElementById("themeSwitch");
        const target = checkbox.checked ? "dark" : "light";
        document.documentElement.setAttribute("data-theme", target);
        localStorage.setItem("APP_THEME", target);
      }
    </script>
  </body>
</html>
