/* --- Animations --- */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideUpCenter {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(40px);
    }

    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(20px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}


/* (Animations defined above) */


/* --- Action Pills (Above Dock) --- */
.action-pills {
    position: absolute;
    bottom: 100px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: flex-end;
    animation: slideInRight 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.3s backwards;
}

/* --- Bottom Control Bar --- */
.bottom-bar {
    position: absolute;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 40px);
    max-width: 500px;
    display: flex;
    gap: 12px;
    z-index: 50;
    pointer-events: none;
    animation: slideUpCenter 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.4s backwards;
}

.control-btn {
    pointer-events: auto;
    border: none;
    border-radius: var(--radius-md);
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s, box-shadow 0.2s;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}

.control-btn:active {
    transform: scale(0.96);
}

.control-btn.secondary {
    width: 56px;
    flex: 0 0 56px;
    background: var(--surface);
    color: var(--text-main);
    border: 1px solid var(--border);
}

.control-btn.primary {
    flex: 1;
    background: var(--primary-gradient);
    color: white;
    font-size: 1.1rem;
    box-shadow: 0 8px 20px -4px var(--primary-glow);
}

/* --- Modal --- */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(4px);
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
}

.modal-overlay.show {
    opacity: 1;
    pointer-events: auto;
}

.modal {
    width: 90%;
    max-width: 400px;
    background: var(--surface-solid);
    border-radius: var(--radius-lg);
    box-shadow: var(--glass-shadow);
    transform: translateY(20px);
    transition: transform 0.3s;
    overflow: hidden;
}

.modal-overlay.show .modal {
    transform: translateY(0);
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    font-size: 1.25rem;
    margin: 0;
}

.close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--text-muted);
    cursor: pointer;
    padding: 0 8px;
}

.modal-body {
    padding: 20px;
}

.modal-desc {
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 20px;
    line-height: 1.4;
}

.form-group {
    margin-bottom: 16px;
}

.form-group label {
    display: block;
    font-size: 0.85rem;
    font-weight: 500;
    margin-bottom: 6px;
    color: var(--text-muted);
}

.form-group input {
    width: 100%;
    padding: 12px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    background: var(--bg-color);
    color: var(--text-main);
    font-size: 1rem;
    transition: border-color 0.2s;
}

.form-group input:focus {
    outline: none;
    border-color: var(--primary);
}

.form-group.row {
    display: flex;
    gap: 12px;
}

.form-group .col {
    flex: 1;
}

.modal-footer {
    padding: 20px;
    border-top: 1px solid var(--border);
}

.full-width {
    width: 100%;
    justify-content: center;
}

/* Header Action alignment override */
.header-actions {
    display: flex;
    gap: 8px;
}

.icon-btn.ghost {
    background: transparent;
    border: none;
}

.icon-btn.ghost:hover {
    background: var(--surface);
}

/* Base styles from previous step MUST be preserved (appended here for context but I will write to file partially or fully? 
   Better write full file content again to ensure integrity since I have the layout)
*/

:root {
    /* Modern Palette */
    --primary: #6366f1;
    --primary-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
    --primary-glow: rgba(99, 102, 241, 0.4);

    --bg-color: #f3f4f6;
    --bg-gradient: linear-gradient(to bottom, #f3f4f6, #e5e7eb);

    --surface: rgba(255, 255, 255, 0.85);
    --surface-solid: #ffffff;

    --text-main: #1f2937;
    --text-muted: #6b7280;
    --border: rgba(229, 231, 235, 0.8);

    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);

    --radius-lg: 24px;
    --radius-md: 16px;
    --radius-sm: 12px;
}

@media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) {
        --bg-color: #0f172a;
        --bg-gradient: linear-gradient(to bottom, #0f172a, #020617);

        --surface: rgba(30, 41, 59, 0.7);
        --surface-solid: #1e293b;

        --text-main: #f8fafc;
        --text-muted: #94a3b8;
        --border: rgba(51, 65, 85, 0.6);

        --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    }
}

/* Manual Dark Mode Override */
:root[data-theme="dark"],
body.dark-mode {
    --bg-color: #0f172a;
    --bg-gradient: linear-gradient(to bottom, #0f172a, #020617);

    --surface: rgba(30, 41, 59, 0.7);
    --surface-solid: #1e293b;

    --text-main: #f8fafc;
    --text-muted: #94a3b8;
    --border: rgba(51, 65, 85, 0.6);

    --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: var(--bg-gradient);
    color: var(--text-main);
    height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* --- Header --- */
/* --- Header --- */
header {
    height: 52px;
    padding: 0 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--surface);
    backdrop-filter: saturate(180%) blur(20px);
    -webkit-backdrop-filter: saturate(180%) blur(20px);
    border-bottom: 0.5px solid var(--border);
    flex-shrink: 0;
    z-index: 100;
    position: relative;
}

.brand {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    font-size: 17px;
    letter-spacing: -0.02em;
    color: var(--text-main);
}

.back-btn-absolute {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background: transparent;
    color: var(--primary);
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
}

.menu-btn {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    color: var(--text-main);
    background: transparent;
    cursor: pointer;
    border: none;
    transition: background 0.2s;
    z-index: 102;
}

.menu-btn:hover {
    background: var(--surface-solid);
}

/* Popover Menu */
.popover-menu {
    position: fixed;
    top: 60px;
    right: 16px;
    background: var(--surface-solid);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.2);
    padding: 8px;
    width: 200px;
    display: none;
    flex-direction: column;
    gap: 4px;
    z-index: 2000;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

.popover-menu.active {
    display: flex;
}

.menu-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: background 0.2s;
    color: var(--text-main);
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    border: none;
    background: transparent;
    width: 100%;
    text-align: left;
}

.menu-item:hover {
    background: var(--bg-color);
}

.click-outside {
    position: fixed;
    inset: 0;
    z-index: 101;
    display: none;
}

/* Switch */
.switch {
    position: relative;
    width: 40px;
    height: 22px;
    flex-shrink: 0;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--border);
    /* Using border color as neutral track */
    transition: .3s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .3s cubic-bezier(0.4, 0.0, 0.2, 1);
    border-radius: 50%;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

input:checked+.slider {
    background-color: var(--primary);
}

input:checked+.slider:before {
    transform: translateX(18px);
}


/* --- Main Editor --- */
main {
    flex: 1;
    position: relative;
    padding: 10px 20px 0 20px;
    display: flex;
    justify-content: center;
}

.editor-wrapper {
    width: 100%;
    max-width: 800px;
    height: 100%;
    background: var(--surface);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-top-left-radius: var(--radius-lg);
    border-top-right-radius: var(--radius-lg);
    border: 1px solid var(--border);
    border-bottom: none;
    box-shadow: var(--glass-shadow);
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
    animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.1s backwards;
}

.status-bar {
    height: 36px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    font-size: 0.75rem;
    color: var(--text-muted);
    background: rgba(255, 255, 255, 0.03);
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: #10b981;
}

textarea#mainEditor {
    flex: 1;
    width: 100%;
    border: none;
    resize: none;
    padding: 20px;
    padding-bottom: 120px;
    /* Space for bottom bar actions */
    background: transparent;
    color: var(--text-main);
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    font-size: 14px;
    line-height: 1.7;
    outline: none;
}

/* Custom Scrollbar */
textarea::-webkit-scrollbar {
    width: 6px;
}

textarea::-webkit-scrollbar-track {
    background: transparent;
}

textarea::-webkit-scrollbar-thumb {
    background-color: var(--border);
    border-radius: 4px;
}

textarea::-webkit-scrollbar-thumb:hover {
    background-color: var(--text-muted);
}

/* --- Pill Buttons --- */
.pill-btn {
    background: var(--surface);
    backdrop-filter: blur(8px);
    padding: 8px 16px;
    border-radius: 50px;
    border: 1px solid var(--border);
    color: var(--text-muted);
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    box-shadow: var(--shadow-sm);
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
}

.pill-btn:hover {
    background: var(--surface-solid);
    color: var(--primary);
    transform: translateX(-4px);
}

.pill-btn.danger:hover {
    color: #ef4444;
}

.pill-btn.primary {
    background: var(--primary-gradient);
    color: white;
    border: none;
    box-shadow: 0 4px 12px var(--primary-glow);
}

.pill-btn.primary:hover {
    background: var(--primary-gradient);
    color: white;
    opacity: 0.9;
}


/* --- Toast --- */
#toast {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%) translateY(-20px);
    background: rgba(15, 23, 42, 0.9);
    backdrop-filter: blur(8px);
    color: white;
    padding: 10px 24px;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 500;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    z-index: 300;
}

#toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

@media (max-width: 600px) {
    header {
        padding: 0 16px;
    }

    main {
        padding: 0;
    }

    .editor-wrapper {
        border-radius: 0;
        border: none;
    }

    .bottom-bar {
        width: calc(100% - 32px);
        bottom: 16px;
    }
}

/* --- Loading Overlay --- */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(4px);
    z-index: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 16px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
}

.loading-overlay.show {
    opacity: 1;
    pointer-events: auto;
}

.spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top: 3px solid white;
    animation: spin 0.8s ease-in-out infinite;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.loading-text {
    color: white;
    font-weight: 600;
    font-size: 16px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* --- Desktop Enhancements --- */
@media (min-width: 1024px) {
    body {
        justify-content: center;
        overflow: hidden;
        /* Prevent body scroll if content fits */
    }

    /* Override header to be more subtle on desktop */
    header {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        background: transparent;
        border-bottom: none;
        padding: 20px 40px;
        justify-content: center;
        /* Centered Title */
    }

    .brand {
        font-size: 1.5rem;
        font-weight: 700;
    }

    .back-btn-absolute {
        left: 40px;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
    }

    .menu-btn {
        right: 40px;
        width: 40px;
        height: 40px;
        /* Ensure it stays absolute if mobile styles set it so, 
           checking file content... yes .menu-btn has pos absolute in base styles. 
           We just adjust right position here. */
    }

    main {
        padding: 0;
        width: 100%;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .editor-wrapper {
        width: 800px;
        height: 70vh;
        max-width: 90%;
        border-radius: 20px;
        /* Fully rounded */
        border: 1px solid var(--border);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        background: var(--surface-solid);
        /* Ensure it's above other elements if needed */
        position: relative;
        overflow: hidden;
    }

    /* Position Action Pills (Clear) inside the status bar area or to the side */
    .action-pills {
        position: absolute;
        top: 20px;
        /* Match padding of editor text area */
        right: 20px;
        bottom: auto;
        animation: none;
        /* Reset mobile animation */
        opacity: 1;
        transform: none;
        z-index: 10;
    }

    /* Make the clear button smaller and less intrusive on desktop */
    .pill-btn.danger {
        background: transparent;
        border: 1px solid transparent;
        box-shadow: none;
        color: var(--text-muted);
        opacity: 0.6;
        padding: 6px 12px;
    }

    .pill-btn.danger:hover {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        opacity: 1;
        transform: none;
    }

    /* Move Bottom Bar (Add Me) inside the editor wrapper at the bottom? 
       Or keep it floating but centered relative to editor.
       Let's put it inside the editor wrapper to make it a self-contained card.
    */
    .bottom-bar {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: calc(100% - 40px);
        max-width: 400px;
        animation: none;
    }

    /* Adjust text area padding to not overlap with bottom bar */
    textarea#mainEditor {
        padding-bottom: 90px;
    }
}