<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="theme-color" content="#0a0a0f" id="themeColorMeta" />
    <meta
      name="description"
      content="Story Card Maker — Create stunning 4K story backgrounds with automatic gradient matching"
    />
    <title>Story Card Maker</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <style>
      /* ─── Reset ──────────────────────────────────────────────── */
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      /* ─── Design Tokens ──────────────────────────────────────── */
      :root {
        --accent-1: #7c6fee;
        --accent-2: #ec4899;
        --accent-3: #06b6d4;

        --bg: #f0f2f8;
        --surface: rgba(255, 255, 255, 0.78);
        --surface-solid: #ffffff;
        --border: rgba(0, 0, 0, 0.07);
        --text-h: #0d0f1a;
        --text-p: #4a5069;
        --text-muted: #8892b0;
        --shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
        --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.12);
        --header-bg: rgba(240, 242, 248, 0.88);

        --radius-pill: 999px;
      }

      [data-theme="dark"] {
        --bg: #0a0a0f;
        --surface: rgba(22, 22, 34, 0.82);
        --surface-solid: #16161f;
        --border: rgba(255, 255, 255, 0.08);
        --text-h: #f0f2ff;
        --text-p: #8892b0;
        --text-muted: #4a5069;
        --shadow: 0 4px 24px rgba(0, 0, 0, 0.5);
        --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.7);
        --header-bg: rgba(10, 10, 15, 0.88);
      }

      /* ─── Base ───────────────────────────────────────────────── */
      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        position: fixed;
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        background: var(--bg);
        color: var(--text-h);
        -webkit-font-smoothing: antialiased;
        transition:
          background 0.4s ease,
          color 0.4s ease;
      }

      /* ─── Animated Mesh Background ───────────────────────────── */
      .bg-mesh {
        position: fixed;
        inset: 0;
        z-index: 0;
        overflow: hidden;
        pointer-events: none;
      }

      .bg-mesh::before,
      .bg-mesh::after {
        content: "";
        position: absolute;
        border-radius: 50%;
        filter: blur(90px);
        opacity: 0.3;
      }

      [data-theme="dark"] .bg-mesh::before,
      [data-theme="dark"] .bg-mesh::after {
        opacity: 0.15;
      }

      .bg-mesh::before {
        width: 70vw;
        height: 70vw;
        top: -25vw;
        left: -20vw;
        background: radial-gradient(circle, #7c6fee, #ec4899);
        animation: floatA 18s ease-in-out infinite alternate;
      }

      .bg-mesh::after {
        width: 55vw;
        height: 55vw;
        bottom: -15vw;
        right: -15vw;
        background: radial-gradient(circle, #06b6d4, #7c6fee);
        animation: floatB 22s ease-in-out infinite alternate;
      }

      @keyframes floatA {
        from {
          transform: translate(0, 0) scale(1);
        }
        to {
          transform: translate(6vw, 5vw) scale(1.1);
        }
      }
      @keyframes floatB {
        from {
          transform: translate(0, 0) scale(1);
        }
        to {
          transform: translate(-5vw, -6vw) scale(1.08);
        }
      }

      /* ─── App Shell ──────────────────────────────────────────── */
      .app-shell {
        position: relative;
        z-index: 1;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      /* ─── Sticky Header ──────────────────────────────────────── */
      .site-header {
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 0 20px;
        height: 56px;
        background: var(--header-bg);
        backdrop-filter: blur(24px) saturate(1.8);
        -webkit-backdrop-filter: blur(24px) saturate(1.8);
        border-bottom: 1px solid var(--border);
        animation: slideDown 0.55s cubic-bezier(0.16, 1, 0.3, 1);
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      /* Back button */
      .back-btn {
        width: 34px;
        height: 34px;
        border-radius: 50%;
        background: var(--surface);
        border: 1px solid var(--border);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: var(--text-h);
        transition: all 0.2s ease;
        box-shadow: var(--shadow);
        flex-shrink: 0;
      }

      .back-btn:hover {
        border-color: var(--accent-1);
        box-shadow: 0 0 0 3px rgba(124, 111, 238, 0.15);
      }

      .back-btn:active {
        transform: scale(0.9);
      }

      .back-btn svg {
        width: 16px;
        height: 16px;
        stroke-width: 2.5;
      }

      /* Title block */
      .header-title-block {
        display: flex;
        flex-direction: column;
        gap: 0;
      }

      .header-eyebrow {
        font-size: 10px;
        font-weight: 600;
        letter-spacing: 1px;
        text-transform: uppercase;
        color: var(--accent-1);
        line-height: 1;
      }

      .header-title {
        font-size: 15px;
        font-weight: 800;
        letter-spacing: -0.3px;
        background: linear-gradient(135deg, var(--text-h) 40%, var(--text-p));
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        line-height: 1.2;
      }

      /* Right actions */
      .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .icon-btn {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: var(--surface);
        border: 1px solid var(--border);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--text-p);
        transition: all 0.2s ease;
        box-shadow: var(--shadow);
      }

      .icon-btn:hover {
        color: var(--text-h);
        border-color: var(--accent-1);
        box-shadow: 0 0 0 3px rgba(124, 111, 238, 0.15);
      }

      .icon-btn:active {
        transform: scale(0.93);
      }

      .icon-btn svg {
        width: 18px;
        height: 18px;
        stroke-width: 2;
      }

      /* ─── Preview Area ────────────────────────────────────────── */
      .preview-container {
        flex: 1;
        min-height: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px 20px 12px;
        animation: fadeUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.1s both;
      }

      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(16px) scale(0.97);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .preview-wrapper {
        width: 100%;
        max-width: min(95vw, calc(62vh * 9 / 16));
        max-height: 62vh;
        aspect-ratio: 9 / 16;
        background: var(--surface);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border-radius: 28px;
        border: 1px solid var(--border);
        box-shadow:
          var(--shadow-lg),
          0 0 0 1px rgba(255, 255, 255, 0.06);
        overflow: hidden;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
        cursor: pointer;
      }

      .preview-wrapper.has-image {
        background: #111;
        border-color: transparent;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.25);
      }

      .preview-wrapper:hover {
        transform: translateY(-5px) scale(1.01);
        box-shadow: 0 28px 70px rgba(124, 111, 238, 0.2);
      }

      .preview-wrapper.drag-over {
        border: 2px dashed var(--accent-1);
        background: color-mix(in srgb, var(--accent-1) 8%, var(--surface));
        transform: scale(1.02);
        box-shadow: 0 0 0 4px rgba(124, 111, 238, 0.2);
      }

      .preview-wrapper:active:not(.drag-over) {
        transform: scale(0.98);
      }

      #previewImg {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: none;
        transition: opacity 0.3s ease;
      }

      /* ─── Empty State ─────────────────────────────────────────── */
      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 12px;
        pointer-events: none;
        transition: all 0.3s ease;
      }

      .preview-wrapper:hover .empty-state {
        transform: scale(1.04);
      }

      .empty-icon-wrap {
        width: 72px;
        height: 72px;
        border-radius: 22px;
        background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 12px 32px rgba(124, 111, 238, 0.35);
        animation: floatIcon 3s ease-in-out infinite;
      }

      @keyframes floatIcon {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .empty-icon-wrap svg {
        width: 32px;
        height: 32px;
        stroke: white;
        stroke-width: 1.8;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .empty-title {
        font-size: 15px;
        font-weight: 700;
        color: var(--text-h);
      }

      .empty-hint {
        font-size: 12px;
        font-weight: 500;
        color: var(--text-muted);
      }

      /* ─── Loader ──────────────────────────────────────────────── */
      .loader {
        width: 44px;
        height: 44px;
        display: none;
        position: relative;
      }

      .loader::before,
      .loader::after {
        content: "";
        position: absolute;
        border-radius: 50%;
        inset: 0;
      }

      .loader::before {
        border: 3px solid color-mix(in srgb, var(--accent-1) 20%, transparent);
      }

      .loader::after {
        border: 3px solid transparent;
        border-top-color: var(--accent-1);
        border-right-color: var(--accent-2);
        animation: spin 0.75s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg) scale(1);
        }
        50% {
          transform: rotate(180deg) scale(1.08);
        }
        100% {
          transform: rotate(360deg) scale(1);
        }
      }

      /* ─── Controls Bar ────────────────────────────────────────── */
      .controls {
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
        padding: 14px 20px 20px;
        animation: slideUpBar 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.2s both;
      }

      @keyframes slideUpBar {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Base button */
      .btn {
        height: 46px;
        padding: 0 24px;
        border: none;
        border-radius: var(--radius-pill);
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 14px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        user-select: none;
        position: relative;
        overflow: hidden;
        letter-spacing: -0.2px;
      }

      .btn svg {
        width: 18px;
        height: 18px;
        stroke-width: 2.2;
        stroke: currentColor;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        flex-shrink: 0;
      }

      .btn:hover svg {
        transform: scale(1.15);
      }

      /* Ripple */
      .btn::after {
        content: "";
        position: absolute;
        inset: 0;
        background: rgba(255, 255, 255, 0.18);
        opacity: 0;
        transition: opacity 0.2s;
      }

      .btn:active::after {
        opacity: 1;
      }

      /* Upload / primary */
      .btn-upload {
        background: linear-gradient(
          135deg,
          var(--accent-1) 0%,
          color-mix(in srgb, var(--accent-1) 70%, var(--accent-2)) 100%
        );
        color: white;
        box-shadow: 0 6px 20px rgba(124, 111, 238, 0.4);
      }

      .btn-upload:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 28px rgba(124, 111, 238, 0.5);
      }

      /* Icon-only (circular) */
      .btn-icon {
        width: 46px;
        height: 46px;
        padding: 0;
        border-radius: 50%;
        min-width: 46px;
      }

      /* Secondary / ghost */
      .btn-ghost {
        background: var(--surface);
        color: var(--text-h);
        border: 1px solid var(--border);
        backdrop-filter: blur(12px);
        box-shadow: var(--shadow);
      }

      .btn-ghost:hover {
        border-color: color-mix(in srgb, var(--accent-1) 50%, transparent);
        box-shadow: var(--shadow-lg);
        transform: translateY(-1px);
      }

      /* Download / share (inactive → active) */
      .btn-download {
        background: var(--surface);
        color: var(--text-muted);
        border: 1px solid var(--border);
        pointer-events: none;
        min-width: 160px;
        backdrop-filter: blur(12px);
        opacity: 0.6;
      }

      .btn-download.active {
        background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
        color: white;
        pointer-events: auto;
        opacity: 1;
        box-shadow: 0 6px 20px rgba(124, 111, 238, 0.4);
        border-color: transparent;
      }

      .btn-download.active:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 28px rgba(124, 111, 238, 0.5);
      }

      input[type="file"] {
        display: none;
      }

      /* ─── Toast ───────────────────────────────────────────────── */
      .toast {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translate(-50%, -120%);
        background: var(--surface-solid);
        border: 1px solid var(--border);
        color: var(--text-h);
        padding: 12px 22px;
        border-radius: var(--radius-pill);
        font-size: 13px;
        font-weight: 600;
        box-shadow: var(--shadow-lg);
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
        opacity: 0;
        transition: all 0.45s cubic-bezier(0.34, 1.56, 0.64, 1);
        visibility: hidden;
        white-space: nowrap;
      }

      .toast.show {
        transform: translate(-50%, 0);
        opacity: 1;
        visibility: visible;
      }

      .toast-icon {
        width: 16px;
        height: 16px;
        stroke-width: 2.5;
        flex-shrink: 0;
      }

      .toast.success {
        background: color-mix(in srgb, #10b981 12%, var(--surface-solid));
        color: #059669;
        border-color: color-mix(in srgb, #10b981 20%, transparent);
      }

      .toast.error {
        background: color-mix(in srgb, #ef4444 12%, var(--surface-solid));
        color: #dc2626;
        border-color: color-mix(in srgb, #ef4444 20%, transparent);
      }

      /* ─── Popover Menu ────────────────────────────────────────── */
      .click-outside {
        position: fixed;
        inset: 0;
        z-index: 999;
        display: none;
      }

      .menu-wrapper {
        position: relative;
      }

      .popover-menu {
        position: fixed;
        background: var(--surface-solid);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 8px;
        width: 220px;
        display: none;
        flex-direction: column;
        gap: 2px;
        z-index: 1000;
        box-shadow: var(--shadow-lg);
        transform-origin: top right;
        animation: menuIn 0.2s cubic-bezier(0.16, 1, 0.3, 1);
      }

      @keyframes menuIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .popover-menu.active {
        display: flex;
      }

      .popover-menu-header {
        padding: 10px 14px 6px;
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 0.8px;
        text-transform: uppercase;
        color: var(--text-muted);
      }

      .popover-divider {
        height: 1px;
        background: var(--border);
        margin: 4px 0;
      }

      .menu-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 11px 14px;
        border-radius: 12px;
        cursor: pointer;
        color: var(--text-h);
        font-size: 14px;
        font-weight: 600;
        background: transparent;
        border: none;
        width: 100%;
        text-align: left;
        transition: background 0.15s;
      }

      .menu-item-left {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .menu-item-icon {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .menu-item-icon svg {
        width: 15px;
        height: 15px;
        stroke-width: 2;
      }

      .menu-item:hover {
        background: color-mix(in srgb, var(--text-h) 6%, transparent);
      }

      /* Switch */
      .switch {
        position: relative;
        width: 38px;
        height: 22px;
        flex-shrink: 0;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        inset: 0;
        background: var(--text-muted);
        transition: 0.3s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 3px;
        bottom: 3px;
        background: white;
        transition: 0.3s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      input:checked + .slider {
        background: var(--accent-1);
      }
      input:checked + .slider:before {
        transform: translateX(16px);
      }

      /* ─── Info Modal ──────────────────────────────────────────── */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        z-index: 500;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 24px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .modal-overlay.active {
        display: flex;
        opacity: 1;
      }

      .modal-card {
        background: var(--surface-solid);
        padding: 36px 32px 28px;
        border-radius: 28px;
        max-width: 340px;
        width: 100%;
        text-align: center;
        transform: translateY(24px) scale(0.96);
        transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
        border: 1px solid var(--border);
        box-shadow: var(--shadow-lg);
      }

      .modal-overlay.active .modal-card {
        transform: translateY(0) scale(1);
      }

      .modal-icon {
        width: 60px;
        height: 60px;
        border-radius: 18px;
        background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        box-shadow: 0 12px 30px rgba(124, 111, 238, 0.35);
      }

      .modal-icon svg {
        width: 28px;
        height: 28px;
        stroke: white;
        stroke-width: 1.8;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }

      .modal-version {
        display: inline-block;
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.5px;
        padding: 4px 12px;
        border-radius: 99px;
        background: color-mix(in srgb, var(--accent-1) 12%, transparent);
        color: var(--accent-1);
        margin-bottom: 12px;
      }

      .modal-title {
        font-size: 22px;
        font-weight: 800;
        letter-spacing: -0.5px;
        color: var(--text-h);
        margin-bottom: 10px;
      }

      .modal-text {
        font-size: 14px;
        color: var(--text-p);
        line-height: 1.65;
        margin-bottom: 24px;
      }

      .modal-text strong {
        color: var(--text-h);
        font-weight: 700;
      }

      .modal-btn {
        background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
        color: white;
        border: none;
        padding: 13px 32px;
        border-radius: 99px;
        font-size: 14px;
        font-weight: 700;
        cursor: pointer;
        width: 100%;
        box-shadow: 0 8px 20px rgba(124, 111, 238, 0.35);
        transition:
          opacity 0.2s,
          transform 0.2s;
      }

      .modal-btn:hover {
        opacity: 0.9;
      }
      .modal-btn:active {
        transform: scale(0.97);
      }

      /* ─── Responsive tweaks ───────────────────────────────────── */
      @media (max-height: 680px) {
        .site-header {
          height: 48px;
        }
        .header-eyebrow {
          display: none;
        }
        .preview-container {
          padding-top: 12px;
          padding-bottom: 6px;
        }
        .controls {
          padding: 10px 20px 14px;
          gap: 8px;
        }
        .btn {
          height: 40px;
          font-size: 13px;
        }
        .btn-icon {
          width: 40px;
          height: 40px;
          min-width: 40px;
        }
      }
    </style>

    <script>
      (function () {
        const t = localStorage.getItem("APP_THEME");
        if (t) document.documentElement.setAttribute("data-theme", t);
        const meta = document.getElementById("themeColorMeta");
        if (meta) meta.content = t === "dark" ? "#0a0a0f" : "#f0f2f8";
      })();
    </script>
  </head>

  <body>
    <!-- Ambient background -->
    <div class="bg-mesh" aria-hidden="true"></div>

    <!-- Click-outside overlay -->
    <div class="click-outside" id="clickOutside" onclick="toggleMenu()"></div>

    <!-- Popover Menu -->
    <div class="popover-menu" id="popoverMenu" role="menu">
      <div class="popover-menu-header">Settings</div>
      <div class="popover-divider"></div>
      <div class="menu-item" onclick="toggleThemeSwitch(event)" role="menuitem">
        <div class="menu-item-left">
          <div
            class="menu-item-icon"
            style="
              background: rgba(124, 111, 238, 0.12);
              color: var(--accent-1);
            "
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
            </svg>
          </div>
          <span>Dark Mode</span>
        </div>
        <label class="switch">
          <input type="checkbox" id="themeSwitch" onchange="toggleTheme()" />
          <span class="slider"></span>
        </label>
      </div>
      <div class="popover-divider"></div>
      <button class="menu-item" onclick="openInfoModal()" role="menuitem">
        <div class="menu-item-left">
          <div
            class="menu-item-icon"
            style="background: rgba(6, 182, 212, 0.12); color: var(--accent-3)"
          >
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="16" x2="12" y2="12" />
              <line x1="12" y1="8" x2="12.01" y2="8" />
            </svg>
          </div>
          <span>About</span>
        </div>
        <svg
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2.5"
          stroke-linecap="round"
          stroke-linejoin="round"
          style="color: var(--text-muted)"
        >
          <polyline points="9 18 15 12 9 6" />
        </svg>
      </button>
    </div>

    <!-- Info Modal -->
    <div
      class="modal-overlay"
      id="infoModal"
      onclick="closeInfoModal(event)"
      role="dialog"
      aria-modal="true"
      aria-labelledby="infoModalTitle"
    >
      <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" />
            <circle cx="12" cy="12" r="4" />
            <path d="M21.17 8A10 10 0 0 1 22 12" />
            <path d="M2.83 8A10 10 0 0 0 2 12" />
          </svg>
        </div>
        <div class="modal-version">v1.2</div>
        <h3 class="modal-title" id="infoModalTitle">Story Card Maker</h3>
        <p class="modal-text">
          Create stunning <strong>gradient-matched backgrounds</strong> for your
          social story cards in seconds.<br /><br />
          Upload any image and the app automatically samples its colors to build
          the perfect gradient backdrop.
          <br /><br />
          <span style="font-size: 12px; color: var(--text-muted)"
            >© 2026 Azizi Yahya</span
          >
        </p>
        <button class="modal-btn" onclick="closeInfoModal(event)">
          Got it
        </button>
      </div>
    </div>

    <div class="app-shell">
      <!-- ── Header ── -->
      <header class="site-header">
        <!-- Left: back + title -->
        <div class="header-left">
          <a href="index.html" class="back-btn" aria-label="Back to home">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
          </a>
          <div class="header-title-block">
            <div class="header-eyebrow">Design Tool</div>
            <div class="header-title">Story Card Maker</div>
          </div>
        </div>

        <!-- Right: theme + menu -->
        <div class="header-actions">
          <button
            class="icon-btn"
            id="themeToggleBtn"
            onclick="quickToggleTheme()"
            title="Toggle theme"
            aria-label="Toggle dark mode"
          >
            <svg
              id="themeIconSun"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="4" />
              <path
                d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"
              />
            </svg>
            <svg
              id="themeIconMoon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              style="display: none"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
            </svg>
          </button>

          <div class="menu-wrapper">
            <button
              class="icon-btn"
              id="menuBtn"
              onclick="toggleMenu()"
              aria-label="Open menu"
              aria-expanded="false"
            >
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="5" r="1" fill="currentColor" />
                <circle cx="12" cy="12" r="1" fill="currentColor" />
                <circle cx="12" cy="19" r="1" fill="currentColor" />
              </svg>
            </button>
          </div>
        </div>
      </header>

      <!-- ── Preview ── -->
      <div class="preview-container">
        <div class="preview-wrapper" id="dropZone">
          <div class="empty-state" id="emptyState">
            <div class="empty-icon-wrap">
              <svg viewBox="0 0 24 24">
                <rect x="3" y="3" width="18" height="18" rx="3" ry="3" />
                <circle cx="8.5" cy="8.5" r="1.5" />
                <polyline points="21 15 16 10 5 21" />
              </svg>
            </div>
            <div class="empty-title">Drop or tap to upload</div>
            <div class="empty-hint">JPG, PNG, WebP, HEIC · up to 50 MB</div>
          </div>
          <div class="loader" id="loader"></div>
          <img id="previewImg" alt="Story Preview" />
        </div>
      </div>

      <!-- ── Controls ── -->
      <div class="controls">
        <button
          class="btn btn-upload"
          id="openBtn"
          onclick="document.getElementById('fileInput').click()"
        >
          <svg viewBox="0 0 24 24">
            <path
              d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
            />
          </svg>
          Open
        </button>

        <button
          class="btn btn-ghost btn-icon"
          id="shuffleBtn"
          onclick="render()"
          style="display: none"
          title="Shuffle gradient"
          aria-label="Shuffle gradient"
        >
          <svg viewBox="0 0 24 24">
            <polyline points="16 3 21 3 21 8" />
            <line x1="4" y1="20" x2="21" y2="3" />
            <polyline points="21 16 21 21 16 21" />
            <line x1="15" y1="15" x2="21" y2="21" />
          </svg>
        </button>

        <button
          class="btn btn-download"
          id="downloadBtn"
          onclick="handleShareOrDownload()"
        >
          <svg viewBox="0 0 24 24">
            <circle cx="18" cy="5" r="3" />
            <circle cx="6" cy="12" r="3" />
            <circle cx="18" cy="19" r="3" />
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
          </svg>
          Share Image
        </button>
      </div>

      <input
        type="file"
        id="fileInput"
        accept="image/*"
        onchange="handleImage(this)"
      />
      <canvas id="storyCanvas" style="display: none"></canvas>

      <!-- Toast -->
      <div class="toast" id="toast" role="status" aria-live="polite">
        <svg
          class="toast-icon"
          id="toastIcon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
        ></svg>
        <span class="toast-message">Message</span>
      </div>
    </div>
    <!-- /.app-shell -->

    <script>
      /* ─────────────────────────────────────────────────────────────
           Theme helpers
        ───────────────────────────────────────────────────────────── */
      function applyThemeIcons(isDark) {
        document.getElementById("themeIconSun").style.display = isDark
          ? "none"
          : "";
        document.getElementById("themeIconMoon").style.display = isDark
          ? ""
          : "none";
        document.getElementById("themeColorMeta").content = isDark
          ? "#0a0a0f"
          : "#f0f2f8";
      }

      function toggleTheme() {
        const cb = document.getElementById("themeSwitch");
        const target = cb.checked ? "dark" : "light";
        document.documentElement.setAttribute("data-theme", target);
        localStorage.setItem("APP_THEME", target);
        applyThemeIcons(target === "dark");
      }

      function quickToggleTheme() {
        const isDark =
          document.documentElement.getAttribute("data-theme") === "dark";
        const target = isDark ? "light" : "dark";
        document.documentElement.setAttribute("data-theme", target);
        localStorage.setItem("APP_THEME", target);
        const cb = document.getElementById("themeSwitch");
        if (cb) cb.checked = !isDark;
        applyThemeIcons(!isDark);
      }

      function toggleThemeSwitch(event) {
        if (!event.target.closest(".switch")) {
          const cb = document.getElementById("themeSwitch");
          cb.checked = !cb.checked;
          toggleTheme();
        }
      }

      /* ─────────────────────────────────────────────────────────────
           Menu helpers
        ───────────────────────────────────────────────────────────── */
      function toggleMenu() {
        const menu = document.getElementById("popoverMenu");
        const overlay = document.getElementById("clickOutside");
        const btn = document.getElementById("menuBtn");
        const isOpen = menu.classList.toggle("active");
        overlay.style.display = isOpen ? "block" : "none";
        btn.setAttribute("aria-expanded", isOpen);
        if (isOpen) {
          const rect = btn.getBoundingClientRect();
          menu.style.top = rect.bottom + 8 + "px";
          menu.style.right = window.innerWidth - rect.right + "px";
        }
      }

      function openInfoModal() {
        toggleMenu();
        document.getElementById("infoModal").classList.add("active");
      }

      function closeInfoModal(e) {
        if (e) e.stopPropagation();
        document.getElementById("infoModal").classList.remove("active");
      }

      /* ─────────────────────────────────────────────────────────────
           Init theme
        ───────────────────────────────────────────────────────────── */
      (function init() {
        const saved = localStorage.getItem("APP_THEME");
        const isDark = saved === "dark";
        if (isDark) {
          const cb = document.getElementById("themeSwitch");
          if (cb) cb.checked = true;
        }
        applyThemeIcons(isDark);
      })();

      window.addEventListener("storage", (e) => {
        if (e.key === "APP_THEME") {
          const isDark = e.newValue === "dark";
          document.documentElement.setAttribute("data-theme", e.newValue);
          const cb = document.getElementById("themeSwitch");
          if (cb) cb.checked = isDark;
          applyThemeIcons(isDark);
        }
      });

      /* ─────────────────────────────────────────────────────────────
           Canvas / Image logic  (unchanged from original)
        ───────────────────────────────────────────────────────────── */
      const canvas = document.getElementById("storyCanvas");
      const ctx = canvas.getContext("2d");
      const previewImg = document.getElementById("previewImg");
      const downloadBtn = document.getElementById("downloadBtn");
      const openBtn = document.getElementById("openBtn");
      const shuffleBtn = document.getElementById("shuffleBtn");
      const emptyState = document.getElementById("emptyState");
      const loader = document.getElementById("loader");
      const dropZone = document.getElementById("dropZone");

      const CANVAS_WIDTH = 2160;
      const CANVAS_HEIGHT = 3840;
      canvas.width = CANVAS_WIDTH;
      canvas.height = CANVAS_HEIGHT;

      const CORNER_RADIUS = 60;
      const SHADOW_BLUR = 100;

      let currentImgObj = null;

      /* Toast ─────────────────────────── */
      function showToast(message, duration = 3000, type = "error") {
        const toast = document.getElementById("toast");
        const msgEl = toast.querySelector(".toast-message");
        const iconEl = document.getElementById("toastIcon");

        msgEl.textContent = message;

        // SVG paths for icon
        if (type === "success") {
          iconEl.innerHTML = '<polyline points="20 6 9 17 4 12"/>';
          toast.classList.add("success");
          toast.classList.remove("error");
        } else {
          iconEl.innerHTML =
            '<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>';
          toast.classList.add("error");
          toast.classList.remove("success");
        }

        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), duration);
      }

      /* Drag & Drop ───────────────────── */
      ["dragenter", "dragover", "dragleave", "drop"].forEach((ev) =>
        dropZone.addEventListener(
          ev,
          (e) => {
            e.preventDefault();
            e.stopPropagation();
          },
          false,
        ),
      );

      dropZone.addEventListener("dragenter", () =>
        dropZone.classList.add("drag-over"),
      );
      dropZone.addEventListener("dragleave", (e) => {
        if (e.target === dropZone) dropZone.classList.remove("drag-over");
      });
      dropZone.addEventListener("drop", (e) => {
        dropZone.classList.remove("drag-over");
        if (e.dataTransfer.files.length > 0)
          handleImageFile(e.dataTransfer.files[0]);
      });

      dropZone.addEventListener("click", () => {
        if (!currentImgObj) document.getElementById("fileInput").click();
      });

      document.addEventListener("keydown", (e) => {
        if ((e.key === "s" || e.key === "S") && e.ctrlKey && currentImgObj) {
          e.preventDefault();
          handleShareOrDownload();
        }
      });

      /* File handling ─────────────────── */
      function handleImage(input) {
        if (input.files[0]) handleImageFile(input.files[0]);
      }

      function handleImageFile(file) {
        if (!file) return;

        const validTypes = [
          "image/jpeg",
          "image/jpg",
          "image/png",
          "image/gif",
          "image/webp",
          "image/bmp",
          "image/svg+xml",
          "image/heic",
          "image/heif",
        ];
        const validExtensions = [
          "jpg",
          "jpeg",
          "png",
          "gif",
          "webp",
          "bmp",
          "svg",
          "heic",
          "heif",
        ];
        const ext = file.name.toLowerCase().split(".").pop();

        if (!validTypes.includes(file.type) && !validExtensions.includes(ext)) {
          showToast("Unsupported format. Use JPG, PNG, GIF, WebP.", 4000);
          return;
        }
        if (file.size > 50 * 1024 * 1024) {
          showToast("File too large! Max 50 MB.", 4000);
          return;
        }

        emptyState.style.display = "none";
        previewImg.style.display = "none";
        loader.style.display = "block";
        downloadBtn.classList.remove("active");

        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            currentImgObj = img;
            render();
            loader.style.display = "none";
            previewImg.style.display = "block";
            dropZone.classList.add("has-image");
            downloadBtn.classList.add("active");

            // Collapse Open button to icon
            openBtn.innerHTML =
              '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>';
            openBtn.classList.add("btn-icon", "btn-ghost");
            openBtn.classList.remove("btn-upload");

            shuffleBtn.style.display = "flex";
            showToast("Image loaded", 2000, "success");
          };
          img.onerror = () => {
            showToast("Failed to load image.", 4000);
            loader.style.display = "none";
            emptyState.style.display = "flex";
            dropZone.classList.remove("has-image");
          };
          img.src = e.target.result;
        };
        reader.onerror = () => {
          showToast("Failed to read file.", 3000);
          loader.style.display = "none";
          emptyState.style.display = "flex";
          dropZone.classList.remove("has-image");
        };
        reader.readAsDataURL(file);
      }

      /* Gradient generation ───────────── */
      function generateSmartGradient(img) {
        const sc = document.createElement("canvas");
        sc.width = sc.height = 5;
        const sctx = sc.getContext("2d");
        sctx.drawImage(img, 0, 0, 5, 5);

        const getCol = (x, y) => {
          const p = sctx.getImageData(x, y, 1, 1).data;
          return {
            rgb: `rgb(${p[0]},${p[1]},${p[2]})`,
            r: p[0],
            g: p[1],
            b: p[2],
          };
        };

        const tl = getCol(0, 0),
          tr = getCol(4, 0);
        const bl = getCol(0, 4),
          br = getCol(4, 4);
        const tm = getCol(2, 0),
          bm = getCol(2, 4);
        const lm = getCol(0, 2),
          rm = getCol(4, 2);

        const gradients = [
          { colors: [tm.rgb, bm.rgb], direction: [0, 0, 0, CANVAS_HEIGHT] },
          {
            colors: [tl.rgb, br.rgb],
            direction: [0, 0, CANVAS_WIDTH, CANVAS_HEIGHT],
          },
          {
            colors: [tr.rgb, bl.rgb],
            direction: [CANVAS_WIDTH, 0, 0, CANVAS_HEIGHT],
          },
          { colors: [lm.rgb, rm.rgb], direction: [0, 0, CANVAS_WIDTH, 0] },
          {
            colors: [bl.rgb, tr.rgb],
            direction: [0, CANVAS_HEIGHT, CANVAS_WIDTH, 0],
          },
          { colors: [bm.rgb, tm.rgb], direction: [0, 0, 0, CANVAS_HEIGHT] },
          { colors: [rm.rgb, lm.rgb], direction: [0, 0, CANVAS_WIDTH, 0] },
          { colors: [bl.rgb, tl.rgb], direction: [0, CANVAS_HEIGHT, 0, 0] },
          {
            colors: [br.rgb, tr.rgb],
            direction: [CANVAS_WIDTH, CANVAS_HEIGHT, CANVAS_WIDTH, 0],
          },
        ];

        const sel = gradients[Math.floor(Math.random() * gradients.length)];
        return { colors: sel.colors, direction: sel.direction };
      }

      /* Render ────────────────────────── */
      function render() {
        if (!currentImgObj) return;

        const gradient = generateSmartGradient(currentImgObj);
        const dir = gradient.direction;
        const grad = ctx.createLinearGradient(dir[0], dir[1], dir[2], dir[3]);
        grad.addColorStop(0, gradient.colors[0]);
        grad.addColorStop(1, gradient.colors[1]);
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

        const targetWidth = CANVAS_WIDTH * 0.7;
        const scaleFactor = targetWidth / currentImgObj.width;
        let finalWidth = targetWidth;
        let finalHeight = currentImgObj.height * scaleFactor;

        if (finalHeight > CANVAS_HEIGHT * 0.85) {
          const hs = (CANVAS_HEIGHT * 0.85) / currentImgObj.height;
          finalHeight = CANVAS_HEIGHT * 0.85;
          finalWidth = currentImgObj.width * hs;
        }

        const x = (CANVAS_WIDTH - finalWidth) / 2;
        const y = (CANVAS_HEIGHT - finalHeight) / 2;

        ctx.save();
        ctx.shadowColor = "rgba(0,0,0,0.4)";
        ctx.shadowBlur = SHADOW_BLUR;
        ctx.shadowOffsetY = 60;
        ctx.beginPath();
        ctx.roundRect(x, y, finalWidth, finalHeight, CORNER_RADIUS);
        ctx.fillStyle = "#000";
        ctx.fill();
        ctx.shadowColor = "transparent";
        ctx.clip();
        ctx.drawImage(currentImgObj, x, y, finalWidth, finalHeight);
        ctx.restore();

        previewImg.src = canvas.toDataURL("image/jpeg", 0.8);
      }

      /* Share / Download ──────────────── */
      async function handleShareOrDownload() {
        if (!currentImgObj) return;

        const originalHtml = downloadBtn.innerHTML;
        downloadBtn.innerHTML =
          '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" style="width:18px;height:18px;animation:spin 0.75s linear infinite"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Processing…';

        try {
          canvas.toBlob(
            async (blob) => {
              if (!blob) {
                showToast("Failed to generate image.", 3000, "error");
                downloadBtn.innerHTML = originalHtml;
                return;
              }

              const fileName = `story-card-${Date.now()}.png`;
              const file = new File([blob], fileName, { type: "image/png" });

              if (
                navigator.share &&
                navigator.canShare &&
                navigator.canShare({ files: [file] })
              ) {
                try {
                  await navigator.share({
                    files: [file],
                    title: "My Story Card",
                    text: "Check out this background I made!",
                  });
                  showToast("Shared successfully!", 3000, "success");
                  downloadBtn.innerHTML = originalHtml;
                } catch (shareErr) {
                  if (shareErr.name !== "AbortError") {
                    triggerDownload(blob);
                  } else {
                    downloadBtn.innerHTML = originalHtml;
                  }
                }
              } else {
                if (
                  window.location.protocol === "http:" &&
                  window.location.hostname !== "localhost"
                ) {
                  showToast("Sharing needs HTTPS. Downloading instead…", 4000);
                }
                triggerDownload(blob);
              }
            },
            "image/png",
            1.0,
          );
        } catch (err) {
          showToast("Action failed.", 3000, "error");
          downloadBtn.innerHTML = originalHtml;
        }

        function triggerDownload(blob) {
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.download = `story-card-${Date.now()}.png`;
          link.href = url;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          setTimeout(() => URL.revokeObjectURL(url), 100);
          showToast("Image downloaded!", 3000, "success");
          downloadBtn.innerHTML = originalHtml;
        }
      }

      /* Reset ─────────────────────────── */
      function resetApp() {
        currentImgObj = null;
        ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        previewImg.style.display = "none";
        emptyState.style.display = "flex";
        dropZone.classList.remove("has-image");
        downloadBtn.classList.remove("active");

        openBtn.innerHTML =
          '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg> Open';
        openBtn.classList.remove("btn-icon", "btn-ghost");
        openBtn.classList.add("btn-upload");
        shuffleBtn.style.display = "none";
        document.getElementById("fileInput").value = "";
      }
    </script>
  </body>
</html>
