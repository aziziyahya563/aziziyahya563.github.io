<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0a0a0f" id="themeColorMeta">
    <title>Arduino Projects - DIY Electronics</title>
    <meta name="description"
        content="Discover creative Arduino projects with step-by-step guides and curated component affiliate links. From beginner to advanced projects, find inspiration for your next build.">
    <meta name="keywords"
        content="arduino projects, DIY electronics, microcontroller, IoT, smart home, arduino tutorial, affiliate links">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/arduino-projects.css">
    <script src="js/products-db.js"></script>
    <script>
        (function () {
            const t = localStorage.getItem('APP_THEME');
            if (t) {
                document.documentElement.setAttribute('data-theme', t);
                const m = document.getElementById('themeColorMeta');
                if (m) m.content = t === 'dark' ? '#0a0a0f' : '#f0f2f8';
            }
        })();
    </script>
</head>

<body>
    <!-- Mesh background -->
    <div class="bg-mesh" aria-hidden="true"></div>

    <div class="click-outside" id="clickOutside" onclick="toggleMenu()"></div>

    <!-- Popover menu -->
    <div class="popover-menu" id="popoverMenu" role="menu">
        <div style="padding:10px 14px 6px;font-size:11px;font-weight:600;letter-spacing:0.8px;text-transform:uppercase;color:var(--text-muted)">Settings</div>
        <div style="height:1px;background:var(--border);margin:4px 0"></div>
        <div class="menu-item" onclick="toggleThemeSwitch(event)" role="menuitem">
            <div style="display:flex;align-items:center;gap:10px">
                <div style="width:28px;height:28px;border-radius:8px;background:color-mix(in srgb,var(--accent) 12%,transparent);color:var(--accent);display:flex;align-items:center;justify-content:center">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                </div>
                <span>Dark Mode</span>
            </div>
            <label class="switch">
                <input type="checkbox" id="themeSwitch" onchange="toggleTheme()">
                <span class="slider"></span>
            </label>
        </div>
        <div style="height:1px;background:var(--border);margin:4px 0"></div>
        <button class="menu-item" onclick="openInfoModal()" role="menuitem">
            <div style="display:flex;align-items:center;gap:10px">
                <div style="width:28px;height:28px;border-radius:8px;background:rgba(6,182,212,0.12);color:#06b6d4;display:flex;align-items:center;justify-content:center">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                </div>
                <span>About</span>
            </div>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="color:var(--text-muted)"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
    </div>

    <div class="app-layout">
        <div class="background-pattern"></div>

        <header class="header">
            <a href="index.html" class="back-button" aria-label="Back to home">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </a>
            <div class="header-content">
                <div class="header-title-block">
                    <div class="header-eyebrow">Collection</div>
                    <h1>Arduino Projects</h1>
                </div>
                <div class="header-extras">
                    <!-- quick theme toggle -->
                    <button class="icon-btn" onclick="quickToggleTheme()" aria-label="Toggle dark mode" style="border:1px solid var(--border)">
                        <svg id="themeIconSun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg>
                        <svg id="themeIconMoon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                    </button>
                    <button class="menu-btn" id="menuBtn" onclick="toggleMenu()" aria-label="Open menu" aria-expanded="false">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="5"  r="1" fill="currentColor"/>
                            <circle cx="12" cy="12" r="1" fill="currentColor"/>
                            <circle cx="12" cy="19" r="1" fill="currentColor"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search projects..."
                    aria-label="Search Arduino projects">
            </div>

            <div class="filter-group">
                <button class="filter-btn active" data-category="all">All</button>
                <button class="filter-btn" data-category="beginner">Beginner</button>
                <button class="filter-btn" data-category="intermediate">Intermediate</button>
                <button class="filter-btn" data-category="advanced">Advanced</button>
                <button class="filter-btn" data-category="iot">IoT</button>
                <button class="filter-btn" data-category="robotics">Robotics</button>
            </div>
        </div> -->

        <div id="setupGrid" class="setup-grid">
            <!-- Setups will be dynamically inserted here -->
        </div>

    </div>

    <!-- Search Modal -->
    <div id="searchModal" class="search-modal">
        <div class="search-modal-content">
            <div class="search-modal-header">
                <h2 class="search-modal-title">Search Projects</h2>
                <button class="search-modal-close" onclick="closeSearchModal()">‚úï</button>
            </div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search projects..."
                    aria-label="Search Arduino projects">
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div id="filterModal" class="filter-modal">
        <div class="filter-modal-content">
            <div class="filter-modal-header">
                <h2 class="filter-modal-title">Filter by Category</h2>
                <button class="filter-modal-close" onclick="closeFilterModal()">‚úï</button>
            </div>
            <div class="filter-group">
                <button class="filter-btn active" data-category="all">All</button>
                <button class="filter-btn" data-category="beginner">Beginner</button>
                <button class="filter-btn" data-category="intermediate">Intermediate</button>
                <button class="filter-btn" data-category="advanced">Advanced</button>
                <button class="filter-btn" data-category="iot">IoT</button>
                <button class="filter-btn" data-category="robotics">Robotics</button>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-backdrop" onclick="closeModal()"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()" aria-label="Close">‚úï</button>
            <div id="modalBody" class="modal-body">
                <!-- Project details will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-btn active" onclick="scrollToTop()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span class="nav-btn-label">Home</span>
        </button>
        <button class="nav-btn" onclick="openSearchModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <span class="nav-btn-label">Search</span>
        </button>
        <button class="nav-btn" onclick="openFilterModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
            <span class="nav-btn-label">Filter</span>
        </button>
    </nav>
    </div>

    <!-- Info Modal -->
    <div class="modal-overlay" id="infoModal" onclick="closeInfoModal(event)" role="dialog" aria-modal="true">
        <div class="modal-card-info" onclick="event.stopPropagation()">
            <div style="width:60px;height:60px;border-radius:18px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;margin:0 auto 20px;box-shadow:0 12px 30px var(--accent-glow)">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            </div>
            <div style="display:inline-block;font-size:11px;font-weight:700;letter-spacing:0.5px;padding:4px 12px;border-radius:99px;background:color-mix(in srgb,var(--accent) 12%,transparent);color:var(--accent);margin-bottom:12px">v1.3</div>
            <h3 class="info-title">Arduino Projects</h3>
            <p class="info-text">
                Explore <strong>creative Arduino projects</strong> with step-by-step schematics, source code, and curated component affiliate links for your next build.<br><br>
                <span style="font-size:12px;color:var(--text-muted)">¬© 2026 Azizi Yahya</span>
            </p>
            <button class="info-btn" onclick="closeInfoModal(event)">Got it</button>
        </div>
    </div>

    <script>
        /* ‚îÄ‚îÄ Theme helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        function applyThemeIcons(isDark) {
            const sun  = document.getElementById('themeIconSun');
            const moon = document.getElementById('themeIconMoon');
            const meta = document.getElementById('themeColorMeta');
            if (sun)  sun.style.display  = isDark ? 'none' : '';
            if (moon) moon.style.display = isDark ? ''     : 'none';
            if (meta) meta.content = isDark ? '#0a0a0f' : '#f0f2f8';
        }

        function toggleTheme() {
            const cb = document.getElementById('themeSwitch');
            const target = cb.checked ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', target);
            localStorage.setItem('APP_THEME', target);
            applyThemeIcons(target === 'dark');
        }

        function quickToggleTheme() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const target = isDark ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', target);
            localStorage.setItem('APP_THEME', target);
            const cb = document.getElementById('themeSwitch');
            if (cb) cb.checked = !isDark;
            applyThemeIcons(!isDark);
        }

        function toggleThemeSwitch(event) {
            if (!event.target.closest('.switch')) {
                const cb = document.getElementById('themeSwitch');
                cb.checked = !cb.checked;
                toggleTheme();
            }
        }

        /* ‚îÄ‚îÄ Menu helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        function toggleMenu() {
            const menu    = document.getElementById('popoverMenu');
            const overlay = document.getElementById('clickOutside');
            const btn     = document.getElementById('menuBtn');
            if (!menu || !overlay) return;
            const isOpen = menu.classList.toggle('active');
            overlay.style.display = isOpen ? 'block' : 'none';
            if (btn) btn.setAttribute('aria-expanded', isOpen);

            if (isOpen && btn) {
                const rect = btn.getBoundingClientRect();
                menu.style.top   = (rect.bottom + 8) + 'px';
                menu.style.right = (window.innerWidth - rect.right) + 'px';
            }
        }

        function openInfoModal() {
            // Close menu if it's open
            const menu = document.getElementById('popoverMenu');
            if (menu && menu.classList.contains('active')) {
                toggleMenu();
            }

            const modal = document.getElementById('infoModal');
            if (modal) {
                modal.classList.add('active');
                // Lock scroll when modal is open
                document.body.style.overflow = 'hidden';
            } else {
                console.error('Info Modal not found!');
            }
        }

        function closeInfoModal(e) {
            if (e) e.stopPropagation();
            const modal = document.getElementById('infoModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        /* ‚îÄ‚îÄ Init theme on load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        (function(){
            const saved = localStorage.getItem('APP_THEME');
            const isDark = saved === 'dark';
            const cb = document.getElementById('themeSwitch');
            if (cb && isDark) cb.checked = true;
            applyThemeIcons(isDark);
        })();

        /* ‚îÄ‚îÄ Cross-tab theme sync ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        window.addEventListener('storage', (e) => {
            if (e.key === 'APP_THEME') {
                const isDark = e.newValue === 'dark';
                document.documentElement.setAttribute('data-theme', e.newValue);
                const cb = document.getElementById('themeSwitch');
                if (cb) cb.checked = isDark;
                applyThemeIcons(isDark);
            }
        });

        // ========================================
        // SCROLL BEHAVIOR
        // ========================================

        let lastScrollTop = 0;
        const header = document.querySelector('.header');

        window.addEventListener('scroll', function () {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            if (scrollTop > lastScrollTop && scrollTop > 100) {
                // Scrolling down
                header.classList.add('hidden');
            } else {
                // Scrolling up
                header.classList.remove('hidden');
            }

            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        }, false);

        // ========================================
        // MODAL FUNCTIONS
        // ========================================

        function openSearchModal() {
            document.getElementById('searchModal').classList.add('active');
            setTimeout(() => {
                document.getElementById('searchInput').focus();
            }, 300);
        }

        function closeSearchModal() {
            document.getElementById('searchModal').classList.remove('active');
        }

        function openFilterModal() {
            document.getElementById('filterModal').classList.add('active');
        }

        function closeFilterModal() {
            document.getElementById('filterModal').classList.remove('active');
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Close modals when clicking backdrop
        document.getElementById('searchModal').addEventListener('click', function (e) {
            if (e.target === this) closeSearchModal();
        });

        document.getElementById('filterModal').addEventListener('click', function (e) {
            if (e.target === this) closeFilterModal();
        });

        // ========================================
        // ARDUINO PROJECTS DATABASE
        // ========================================

        // Arduino Projects Database
        // This array can easily be expanded to hundreds of projects
        const deskSetups = [
            {
                id: 1,
                title: "Robot Vacuum Cleaner",
                category: "beginner",
                description: "Build your own autonomous robot vacuum cleaner using Arduino! This smart bot navigates obstacles with ultrasonic sensors while cleaning your floor with a custom suction system.",
                image: "assets/arduinoProjects/img/001.jpg",
                products: [
                    PRODUCTS.arduino_uno,
                    PRODUCTS.motor_driver_l293d,
                    PRODUCTS.chassis_kit_2wd,
                    PRODUCTS.dc_motor_standard,
                    PRODUCTS.servo_sg90,
                    PRODUCTS.battery_18650_x2,
                    PRODUCTS.sensor_ultrasonic,
                    PRODUCTS.switch_power,
                    PRODUCTS.battery_holder,
                    PRODUCTS.battery_holder,
                    PRODUCTS.dust_container,
                    PRODUCTS.wires_jumper
                ],
                schematic: "assets/arduinoProjects/schematics/001_schematic.jpg",
                code: "assets/arduinoProjects/code/vacuumRobot_with_antiCollision.ino",
                flowchart: "assets/arduinoProjects/flowcharts/001_flowchart.png"
            }
            // {
            //     id: 2,
            //     title: "RGB LED Strip Controller",
            //     category: "beginner",
            //     description: "Control WS2812B LED strips with IR remote and mobile app. Create stunning lighting effects!",
            //     image: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&auto=format&fit=crop",
            //     products: [
            //         { name: "Arduino Nano", icon: "üîå", url: "#" },
            //         { name: "WS2812B LED Strip 5M", icon: "üåà", url: "#" },
            //         { name: "IR Receiver Module", icon: "üì°", url: "#" },
            //         { name: "5V 10A Power Supply", icon: "üîã", url: "#" },
            //         { name: "IR Remote Control", icon: "üéÆ", url: "#" }
            //     ]
            // },
            // {
            //     id: 3,
            //     title: "Line Following Robot",
            //     category: "robotics",
            //     description: "Autonomous robot that follows black lines using IR sensors. Great introduction to robotics!",
            //     image: "https://images.unsplash.com/photo-1563207153-f403bf289096?w=800&auto=format&fit=crop",
            //     products: [
            //         { name: "Arduino Uno R3", icon: "üîå", url: "#" },
            //         { name: "L298N Motor Driver", icon: "‚öôÔ∏è", url: "#" },
            //         { name: "IR Line Sensor Module", icon: "üëÅÔ∏è", url: "#" },
            //         { name: "DC Motors & Wheels", icon: "üõû", url: "#" },
            //         { name: "Robot Chassis Kit", icon: "ü§ñ", url: "#" }
            //     ]
            // },
            // {
            //     id: 4,
            //     title: "MQTT Home Automation Hub",
            //     category: "iot",
            //     description: "ESP32-based home automation system with MQTT protocol. Control lights, fans, and more remotely!",
            //     image: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&auto=format&fit=crop",
            //     products: [
            //         { name: "ESP32 DevKit V1", icon: "üîå", url: "#" },
            //         { name: "4-Channel Relay Module", icon: "üîå", url: "#" },
            //         { name: "DHT22 Sensor", icon: "üå°Ô∏è", url: "#" },
            //         { name: "PIR Motion Sensor", icon: "üëÅÔ∏è", url: "#" },
            //         { name: "OLED Display 1.3\"", icon: "üìü", url: "#" }
            //     ]
            // },
            // {
            //     id: 5,
            //     title: "Weather Station with Display",
            //     category: "intermediate",
            //     description: "Complete weather station measuring temperature, humidity, pressure, and displaying on TFT screen.",
            //     image: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&auto=format&fit=crop",
            //     products: [
            //         { name: "Arduino Mega 2560", icon: "üîå", url: "#" },
            //         { name: "BME280 Sensor", icon: "üå°Ô∏è", url: "#" },
            //         { name: "2.8\" TFT LCD Touch Screen", icon: "üì±", url: "#" },
            //         { name: "Real Time Clock Module", icon: "‚è∞", url: "#" },
            //         { name: "SD Card Module", icon: "üíæ", url: "#" }
            //     ]
            // },
            // {
            //     id: 6,
            //     title: "Bluetooth Controlled Car",
            //     category: "robotics",
            //     description: "Build a smartphone-controlled RC car with obstacle avoidance using ultrasonic sensors.",
            //     image: "https://images.unsplash.com/photo-1563207153-f403bf289096?w=800&auto=format&fit=crop",
            //     products: [
            //         { name: "Arduino Uno R3", icon: "üîå", url: "#" },
            //         { name: "HC-05 Bluetooth Module", icon: "üì±", url: "#" },
            //         { name: "L293D Motor Driver Shield", icon: "‚öôÔ∏è", url: "#" },
            //         { name: "HC-SR04 Ultrasonic Sensor", icon: "üì°", url: "#" },
            //         { name: "4WD Robot Car Kit", icon: "üöó", url: "#" }
            //     ]
            // },
            // {
            //     id: 7,
            //     title: "CNC Drawing Machine",
            //     category: "advanced",
            //     description: "3-axis CNC machine for drawing. Uses stepper motors and GRBL firmware for precise control.",
            //     image: "https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=800&auto=format&fit=crop",
            //     products: [
            //         { name: "Arduino Uno + CNC Shield", icon: "üîå", url: "#" },
            //         { name: "NEMA 17 Stepper Motors (3x)", icon: "‚öôÔ∏è", url: "#" },
            //         { name: "A4988 Stepper Drivers (3x)", icon: "üîß", url: "#" },
            //         { name: "GT2 Timing Belt & Pulleys", icon: "üîó", url: "#" },
            //         { name: "Linear Rails & Bearings", icon: "üõ§Ô∏è", url: "#" }
            //     ]
            // },
            // {
            //     id: 8,
            //     title: "Voice Controlled LED System",
            //     category: "intermediate",
            //     description: "Control your LED lights using voice commands via Google Assistant or Alexa integration.",
            //     image: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&auto=format&fit=crop",
            //     products: [
            //         { name: "NodeMCU ESP8266", icon: "üîå", url: "#" },
            //         { name: "Relay Module 4-Channel", icon: "üîå", url: "#" },
            //         { name: "WS2812B LED Strip", icon: "üåà", url: "#" },
            //         { name: "5V Power Supply", icon: "üîã", url: "#" }
            //     ]
            // }
        ];

        // ========================================
        // MOBILE-FIRST STATE & CONFIGURATION
        // ========================================

        let currentCategory = 'all';
        let searchQuery = '';
        let currentPage = 1;
        const SETUPS_PER_PAGE = 12; // Load 12 setups at a time

        // Detect mobile device
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        // DOM elements
        const setupGrid = document.getElementById('setupGrid');
        const searchInput = document.getElementById('searchInput');
        const filterButtons = document.querySelectorAll('.filter-btn');

        // ========================================
        // MOBILE HAPTIC FEEDBACK (if supported)
        // ========================================
        function triggerHaptic(style = 'light') {
            if ('vibrate' in navigator && isMobile) {
                const patterns = {
                    light: 10,
                    medium: 20,
                    heavy: 30
                };
                navigator.vibrate(patterns[style] || 10);
            }
        }

        // ========================================
        // GET FILTERED SETUPS
        // ========================================
        function getFilteredSetups() {
            return deskSetups.filter(setup => {
                const matchesCategory = currentCategory === 'all' || setup.category === currentCategory;
                const matchesSearch = setup.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    setup.description.toLowerCase().includes(searchQuery.toLowerCase());
                return matchesCategory && matchesSearch;
            });
        }

        // ========================================
        // RENDER PREVIEW CARD
        // ========================================
        function createSetupCard(setup, index) {
            return `
                <article class="setup-card" data-id="${setup.id}" style="animation-delay: ${index * 50}ms" onclick="openModal(${setup.id})">
                    <img 
                        src="${setup.image}" 
                        alt="${setup.title}" 
                        class="setup-image" 
                        loading="lazy"
                        onerror="this.src='https://via.placeholder.com/800x500/f5f5f7/262626?text=${encodeURIComponent(setup.title)}'"
                    >
                    
                    <div class="card-caption">
                        <h2 class="caption-title">${setup.title}</h2>
                        <p class="caption-text">${setup.description}</p>
                        <div class="caption-footer">
                            <span class="caption-category">${setup.category.replace('-', ' ')}</span>
                            <button class="icon-btn" onclick="event.stopPropagation(); shareSetup(${setup.id})" aria-label="Share" title="Share">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="18" cy="5" r="3"></circle>
                                    <circle cx="6" cy="12" r="3"></circle>
                                    <circle cx="18" cy="19" r="3"></circle>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="tap-to-view">
                        View Project <span style="font-size: 16px; line-height: 1">‚Üí</span>
                    </div>
                </article>
            `;
        }

        // ========================================
        // SHARE SETUP
        // ========================================
        window.shareSetup = async function (setupId) {
            triggerHaptic('light');
            const setup = deskSetups.find(s => s.id === setupId);
            if (!setup) return;

            const shareData = {
                title: setup.title,
                text: `Check out this ${setup.category} setup: ${setup.description}`,
                url: window.location.href + `?setup=${setupId}`
            };

            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                } else {
                    // Fallback: Copy to clipboard
                    await navigator.clipboard.writeText(window.location.href + `?setup=${setupId}`);
                    alert('Link copied to clipboard!');
                }
            } catch (err) {
                if (err.name !== 'AbortError') {
                    console.log('Share failed:', err);
                }
            }
        };

        // ========================================
        // OPEN MODAL WITH FULL DETAILS
        // ========================================
        window.openModal = function (setupId) {
            triggerHaptic('medium');
            const setup = deskSetups.find(s => s.id === setupId);
            if (!setup) return;

            const modal = document.getElementById('detailModal');
            const modalBody = document.getElementById('modalBody');

            // Populate modal with full details
            modalBody.innerHTML = `
                <img 
                    src="${setup.image}" 
                    alt="${setup.title}" 
                    class="modal-image"
                >
                <div class="modal-header">
                    <h1 class="modal-title">${setup.title}</h1>
                    <span class="setup-category">${setup.category.replace('-', ' ')}</span>
                </div>
                
                <p class="modal-description">${setup.description}</p>
                
                <div class="modal-products">
                    <h3 class="products-title">üõí Get the Components</h3>
                    <div class="products-list" id="products-list-${setup.id}">
                        ${setup.products.map((product, index) => {
                const isShopeeValid = product.shopeeUrl && product.shopeeUrl !== '#';
                const isTiktokValid = product.tiktokUrl && product.tiktokUrl !== '#';

                return `
                            <div class="product-item ${index >= 3 ? 'hidden-item' : ''}" data-index="${index}">
                                <div class="product-name">${product.name}</div>
                                <div class="product-links">
                                    <a 
                                        ${isShopeeValid ? `href="${product.shopeeUrl}" target="_blank" rel="noopener noreferrer"` : ''}
                                        class="affiliate-btn shopee-btn ${!isShopeeValid ? 'disabled' : ''}"
                                        onclick="event.stopPropagation(); ${isShopeeValid ? "triggerHaptic('light');" : 'return false;'}"
                                    >
                                        <span class="btn-label">Shopee</span>
                                    </a>
                                    <a 
                                        ${isTiktokValid ? `href="${product.tiktokUrl}" target="_blank" rel="noopener noreferrer"` : ''}
                                        class="affiliate-btn tiktok-btn ${!isTiktokValid ? 'disabled' : ''}"
                                        onclick="event.stopPropagation(); ${isTiktokValid ? "triggerHaptic('light');" : 'return false;'}"
                                    >
                                        <span class="btn-label">TikTok</span>
                                    </a>
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                    ${setup.products.length > 3 ? `
                        <button class="show-more-btn-simple" onclick="toggleProducts(${setup.id}); event.stopPropagation();" data-setup-id="${setup.id}">
                            <span class="show-more-icon">‚Ä¢‚Ä¢‚Ä¢</span>
                            <span class="show-more-text">Show ${setup.products.length - 3} More</span>
                            <svg class="chevron-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                    ` : ''}
                    
                    <div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border-light);">
                         <h3 class="products-title">üìÇ Project Resources</h3>

                          <div style="display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap;">
                             
                             <!-- Schematic Button -->
                             <a 
                                 href="${setup.schematic || '#'}" 
                                 target="_blank"
                                 class="affiliate-btn shopee-btn" 
                                 style="width: auto; flex: 1; min-width: 100px; justify-content: center; background: var(--btn-bg); color: var(--text-primary); border: 1px solid var(--border); ${!setup.schematic ? 'opacity: 0.5;' : ''}" 
                                 onclick="triggerHaptic('light'); ${!setup.schematic ? "alert('Schematic coming soon!'); return false;" : ''}"
                             >
                                 <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                                     <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                     <polyline points="14 2 14 8 20 8"></polyline>
                                     <line x1="16" y1="13" x2="8" y2="13"></line>
                                     <line x1="16" y1="17" x2="8" y2="17"></line>
                                     <polyline points="10 9 9 9 8 9"></polyline>
                                 </svg>
                                 <span>Schematic</span>
                             </a>
 
                             <!-- Code Button -->
                             <a 
                                 href="${setup.code || '#'}" 
                                 target="_blank"
                                 class="affiliate-btn tiktok-btn" 
                                 style="width: auto; flex: 1; min-width: 100px; justify-content: center; background: var(--btn-bg); color: var(--text-primary); border: 1px solid var(--border); ${!setup.code ? 'opacity: 0.5;' : ''}" 
                                 onclick="triggerHaptic('light'); ${!setup.code ? "alert('Code coming soon!'); return false;" : ''}"
                             >
                                 <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                                     <polyline points="16 18 22 12 16 6"></polyline>
                                     <polyline points="8 6 2 12 8 18"></polyline>
                                 </svg>
                                 <span>Code</span>
                             </a>
 
                             <!-- Flowchart Button -->
                             <a 
                                 href="${setup.flowchart || '#'}" 
                                 target="_blank"
                                 class="affiliate-btn" 
                                 style="width: auto; flex: 1; min-width: 100px; justify-content: center; background: var(--btn-bg); color: var(--text-primary); border: 1px solid var(--border); ${!setup.flowchart ? 'opacity: 0.5;' : ''}" 
                                 onclick="triggerHaptic('light'); ${!setup.flowchart ? "alert('Flowchart coming soon!'); return false;" : ''}"
                             >
                                 <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px;">
                                     <rect x="3" y="3" width="7" height="7"></rect>
                                     <rect x="14" y="3" width="7" height="7"></rect>
                                     <rect x="14" y="14" width="7" height="7"></rect>
                                     <rect x="3" y="14" width="7" height="7"></rect>
                                 </svg>
                                 <span>Flowchart</span>
                             </a>
                          </div>
                    </div>

                </div>
                
                <div class="affiliate-disclosure">
                    üîó <strong>Affiliate Links:</strong> This page contains affiliate links. If you purchase through these links, I may earn a small commission at no extra cost to you.
                </div>
            `;

            // Show modal with animation
            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scroll

            // Add touch feedback to product links
            if (isTouch) {
                setTimeout(() => {
                    modalBody.querySelectorAll('.product-link').forEach(link => {
                        link.addEventListener('touchstart', function () {
                            triggerHaptic('light');
                        }, { passive: true });
                    });
                }, 100);
            }
        };

        // ========================================
        // TOGGLE PRODUCTS VISIBILITY
        // ========================================
        window.toggleProducts = function (setupId) {
            triggerHaptic('light');
            const productsList = document.getElementById(`products-list-${setupId}`);
            const btn = document.querySelector(`[data-setup-id="${setupId}"]`);
            const hiddenItems = productsList.querySelectorAll('.hidden-item');
            const isExpanded = productsList.classList.contains('expanded');
            const totalProducts = productsList.querySelectorAll('.product-item').length;

            if (isExpanded) {
                // Collapse
                hiddenItems.forEach(item => {
                    item.style.maxHeight = item.scrollHeight + 'px';
                    setTimeout(() => {
                        item.style.maxHeight = '0';
                    }, 10);
                });
                productsList.classList.remove('expanded');
                btn.querySelector('.show-more-text').textContent = `Show ${totalProducts - 3} More`;
                btn.classList.remove('expanded');
            } else {
                // Expand
                productsList.classList.add('expanded'); // Add class first to restore padding/border
                hiddenItems.forEach(item => {
                    // Add buffer to ensure we clear borders and avoid clipping
                    item.style.maxHeight = (item.scrollHeight + 20) + 'px';
                });

                // Clear fixed height after animation to allow responsiveness
                setTimeout(() => {
                    hiddenItems.forEach(item => {
                        item.style.maxHeight = null;
                    });
                }, 310);

                btn.querySelector('.show-more-text').textContent = 'Show Less';
                btn.classList.add('expanded');
            }
        };

        // ========================================
        // CLOSE MODAL
        // ========================================
        window.closeModal = function () {
            triggerHaptic('light');
            const modal = document.getElementById('detailModal');
            modal.classList.remove('active');
            document.body.style.overflow = ''; // Restore scroll
        };

        // Close modal on ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // ========================================
        // RENDER SETUPS WITH PAGINATION
        // ========================================
        function renderSetups(append = false) {
            const filteredSetups = getFilteredSetups();
            const totalSetups = filteredSetups.length;

            // Remove existing load more button if any
            const existingButton = document.getElementById('loadMoreBtn');
            if (existingButton) existingButton.remove();

            if (totalSetups === 0) {
                setupGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <h3>No setups found</h3>
                        <p>Try adjusting your filters or search terms</p>
                    </div>
                `;
                return;
            }

            // Calculate which setups to show
            const setupsToShow = filteredSetups.slice(0, currentPage * SETUPS_PER_PAGE);
            const hasMore = totalSetups > setupsToShow.length;

            // Render cards
            if (!append) {
                setupGrid.innerHTML = setupsToShow.map((setup, index) => createSetupCard(setup, index)).join('');
            } else {
                // Append new cards (for "Load More")
                const startIndex = (currentPage - 1) * SETUPS_PER_PAGE;
                const newCards = filteredSetups.slice(startIndex, currentPage * SETUPS_PER_PAGE);
                setupGrid.insertAdjacentHTML('beforeend', newCards.map((setup, index) => createSetupCard(setup, index)).join(''));
            }

            // Add Load More button if there are more setups
            if (hasMore) {
                const remaining = totalSetups - setupsToShow.length;
                const loadMoreBtn = document.createElement('div');
                loadMoreBtn.id = 'loadMoreBtn';
                loadMoreBtn.className = 'load-more-container';
                loadMoreBtn.innerHTML = `
                    <button class="load-more-btn" onclick="loadMore()">
                        <span class="load-more-icon">‚¨áÔ∏è</span>
                        <span class="load-more-text">Load More Setups</span>
                        <span class="load-more-count">(${remaining} remaining)</span>
                    </button>
                    <div class="showing-count">Showing ${setupsToShow.length} of ${totalSetups} setups</div>
                `;
                setupGrid.parentElement.insertBefore(loadMoreBtn, setupGrid.nextSibling);
            }

            // Add touch feedback to product links (mobile only)
            if (isTouch) {
                addTouchFeedback();
            }

            // Observe new cards
            if ('IntersectionObserver' in window) {
                setTimeout(() => observeNewCards(), 50);
            }
        }

        // ========================================
        // LOAD MORE FUNCTION
        // ========================================
        window.loadMore = function () {
            triggerHaptic('medium');
            currentPage++;
            renderSetups(true);

            // Smooth scroll to first new card
            setTimeout(() => {
                const cards = document.querySelectorAll('.setup-card');
                const firstNewCard = cards[cards.length - Math.min(SETUPS_PER_PAGE, cards.length)];
                if (firstNewCard) {
                    firstNewCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        };

        // ========================================
        // MOBILE TOUCH FEEDBACK
        // ========================================
        function addTouchFeedback() {
            document.querySelectorAll('.product-link').forEach(link => {
                link.addEventListener('touchstart', function () {
                    triggerHaptic('light');
                }, { passive: true });
            });
        }

        // ========================================
        // SEARCH INPUT - Mobile optimized
        // ========================================
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                searchQuery = e.target.value;
                currentPage = 1; // Reset to first page
                renderSetups(false);
            }, 150);
        });

        searchInput.addEventListener('search', (e) => {
            if (e.target.value === '') {
                searchQuery = '';
                currentPage = 1;
                renderSetups(false);
            }
        });

        // ========================================
        // FILTER BUTTONS - With haptic feedback
        // ========================================
        // Get filter buttons from both locations (desktop controls and modal)
        const allFilterButtons = document.querySelectorAll('.filter-btn');

        allFilterButtons.forEach(button => {
            button.addEventListener('click', () => {
                triggerHaptic('light');

                // Update all filter buttons (in case there are multiple sets)
                allFilterButtons.forEach(btn => {
                    if (btn.dataset.category === button.dataset.category) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });

                currentCategory = button.dataset.category;
                currentPage = 1; // Reset to first page
                renderSetups(false);

                // Close filter modal if it's open
                closeFilterModal();

                if (isMobile) {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });
        });

        // ========================================
        // INITIAL RENDER
        // ========================================
        renderSetups();

        // ========================================
        // SCROLL REVEAL ANIMATION (Intersection Observer)
        // ========================================
        let observer;
        if ('IntersectionObserver' in window) {
            const observerOptions = {
                threshold: 0.05,
                rootMargin: '0px 0px -30px 0px'
            };

            observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            const observeCards = () => {
                document.querySelectorAll('.setup-card').forEach(card => {
                    if (!card.dataset.observed) {
                        card.style.opacity = '0';
                        card.style.transform = 'translateY(16px)';
                        observer.observe(card);
                        card.dataset.observed = 'true';
                    }
                });
            };

            setTimeout(observeCards, 50);

            // Function to observe new cards when loading more
            window.observeNewCards = observeCards;
        }

        // ========================================
        // MOBILE PULL-TO-REFRESH HINT
        // ========================================
        if (isMobile) {
            let touchStartY = 0;
            let touchEndY = 0;

            document.addEventListener('touchstart', (e) => {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });

            document.addEventListener('touchend', (e) => {
                touchEndY = e.changedTouches[0].clientY;
                // If pulled down significantly at top of page, could add refresh hint
                if (touchEndY - touchStartY > 100 && window.scrollY === 0) {
                    // Optional: Add visual feedback for pull-to-refresh
                    console.log('Pull to refresh detected');
                }
            }, { passive: true });
        }

        // ========================================
        // PERFORMANCE: Lazy load images
        // ========================================
        if ('loading' in HTMLImageElement.prototype) {
            // Browser supports native lazy loading (already added in HTML)
            console.log('‚úì Native lazy loading supported');
        }

        // ========================================
        // ACCESSIBILITY: Announce filter changes
        // ========================================
        function announceToScreenReader(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('role', 'status');
            announcement.setAttribute('aria-live', 'polite');
            announcement.className = 'sr-only';
            announcement.textContent = message;
            document.body.appendChild(announcement);
            setTimeout(() => announcement.remove(), 1000);
        }

        // Add screen reader announcement styles
        const style = document.createElement('style');
        style.textContent = `
            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border-width: 0;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>

</html>