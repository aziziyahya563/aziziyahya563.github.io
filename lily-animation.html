<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lily Animation</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* CSS Variables for easy customization */
      :root {
        /* Color Palette */
        --color-primary: #1a1a2e;
        --color-secondary: #000000;
        --color-stem-start: #2d5a27;
        --color-stem-middle: #4a8a44;
        --color-leaf-start: #1e3f1b;
        --color-leaf-middle: #4a8a44;
        --color-leaf-end: #2d5a27;
        --color-petal-gradient-1: #fff0f5;
        --color-petal-gradient-2: #ffc0cb;
        --color-petal-gradient-3: #ff69b4;
        --color-petal-inner-start: #ffd700;
        --color-petal-inner-middle: #fff;
        --color-petal-inner-end: #ffc0cb;
        --color-petal-outer-start: #ffd700;
        --color-petal-outer-middle: #fff;
        --color-petal-outer-end: #ffb6c1;
        --color-petal-spot: rgba(139, 0, 0, 0.7);
        --color-stamen: linear-gradient(to top, #ccffcc, #fff);
        --color-anther: #8b4513;
        --color-pistil: linear-gradient(to top, #90ee90, #32cd32);
        --color-stigma: radial-gradient(#8b0000, #4a0000);

        /* Animation Timings */
        --animation-duration-stem: 1500ms;
        --animation-duration-leaf: 500ms;
        --animation-duration-bloom: 2000ms;
        --animation-duration-reproductive: 1500ms;
        --animation-duration-total: 3500ms;

        /* Sizing */
        --size-stem-height: 400px;
        --size-stem-width: 6px;
        --size-petal-height: 140px;
        --size-petal-width: 60px;
        --size-leaf-width: 60px;
        --size-leaf-height: 30px;
        --size-container-padding: 20px;

        /* Z-index Layers */
        --z-background: 0;
        --z-stem: 1;
        --z-leaf: 2;
        --z-petal-outer: 15;
        --z-petal-inner: 20;
        --z-stamen: 25;
        --z-pistil: 30;
        --z-controls: 1000;

        /* Shadows */
        --shadow-stem: 2px 0 10px rgba(0, 0, 0, 0.5);
        --shadow-leaf: 2px 2px 5px rgba(0, 0, 0, 0.3);
        --shadow-petal: 0 4px 8px rgba(0, 0, 0, 0.2);
        --shadow-button-hover: 0 5px 15px rgba(0, 0, 0, 0.3);
        --shadow-anther: 0 0 2px rgba(0, 0, 0, 0.5);

        /* Transitions */
        --transition-fast: 0.2s ease;
        --transition-medium: 0.3s ease;
        --transition-slow: 0.5s ease;
      }

      /* Reset and Base Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: radial-gradient(
          circle at center,
          var(--color-primary) 0%,
          var(--color-secondary) 100%
        );
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: white;
        line-height: 1.6;
      }

      /* Animation Container */
      .animation-wrapper {
        position: relative;
        width: 100%;
        max-width: 1200px;
        height: 100vh;
        margin: 0 auto;
        overflow: hidden;
      }

      #animation-container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }

      /* Navigation */
      .back-btn {
        position: fixed;
        top: 30px;
        left: 30px;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        text-decoration: none;
        color: white;
        z-index: var(--z-controls);
        transition: all var(--transition-medium);
        backdrop-filter: blur(5px);
      }

      .back-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
      }

      .back-btn:active {
        transform: scale(1);
      }

      /* Flower Parts */
      .stem {
        position: absolute;
        width: var(--size-stem-width);
        background: linear-gradient(
          to right,
          var(--color-stem-start),
          var(--color-stem-middle),
          var(--color-stem-start)
        );
        border-radius: 3px;
        transform-origin: bottom center;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        box-shadow: var(--shadow-stem);
        z-index: var(--z-stem);
      }

      .leaf {
        position: absolute;
        background: linear-gradient(
          135deg,
          var(--color-leaf-start) 0%,
          var(--color-leaf-middle) 50%,
          var(--color-leaf-end) 100%
        );
        transform-origin: bottom;
        box-shadow: var(--shadow-leaf);
        z-index: var(--z-leaf);
        border-radius: 0% 80% 0% 80%;
        opacity: 0;
      }

      .flower-center {
        position: absolute;
        left: 50%;
        width: 0;
        height: 0;
        transform: translate(0, 0);
        z-index: var(--z-pistil);
      }

      .petal {
        position: absolute;
        bottom: 0;
        left: 50%;
        transform-origin: center bottom;
        box-shadow: var(--shadow-petal);
        border-radius: 50% 50% 10% 10%;
        clip-path: polygon(
          50% 0%,
          80% 20%,
          100% 50%,
          80% 80%,
          50% 100%,
          20% 80%,
          0% 50%,
          20% 20%
        );
        width: var(--size-petal-width);
        height: 0;
        opacity: 0;
        transition: opacity var(--transition-slow);
      }

      .petal.inner {
        z-index: var(--z-petal-inner);
        background: linear-gradient(
          to top,
          var(--color-petal-inner-start) 0%,
          var(--color-petal-inner-middle) 30%,
          var(--color-petal-inner-end) 100%
        );
      }

      .petal.outer {
        z-index: var(--z-petal-outer);
        background: linear-gradient(
          to top,
          var(--color-petal-outer-start) 0%,
          var(--color-petal-outer-middle) 20%,
          var(--color-petal-outer-end) 100%
        );
      }

      .petal-spot {
        position: absolute;
        background: var(--color-petal-spot);
        border-radius: 50%;
        filter: blur(0.5px);
        pointer-events: none;
      }

      .stamen {
        position: absolute;
        width: 2px;
        background: var(--color-stamen);
        transform-origin: bottom center;
        z-index: var(--z-stamen);
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
      }

      .anther {
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 8px;
        height: 15px;
        background: var(--color-anther);
        border-radius: 5px;
        box-shadow: var(--shadow-anther);
      }

      .pistil {
        position: absolute;
        width: 4px;
        background: var(--color-pistil);
        transform-origin: bottom center;
        z-index: var(--z-pistil);
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 2px;
      }

      .stigma {
        position: absolute;
        top: -5px;
        left: 50%;
        transform: translateX(-50%);
        width: 12px;
        height: 12px;
        background: var(--color-stigma);
        border-radius: 50%;
      }

      /* Animations */
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }

        50% {
          opacity: 0.5;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.9);
        }

        to {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }

      /* Reduced Motion Preference */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    </style>
  </head>

  <body>
    <!-- Navigation -->
    <a href="index.html" class="back-btn" aria-label="Go back to homepage">
      <i class="fas fa-arrow-left"></i>
    </a>

    <!-- Animation Container -->
    <div class="animation-wrapper">
      <div
        id="animation-container"
        role="img"
        aria-label="Animated lily flower growing and blooming"
      >
        <!-- Flower will be generated here -->
      </div>
    </div>

    <script>
      class LilyAnimation {
        constructor(containerId) {
          this.container = document.getElementById(containerId);
          this.isAnimating = false;
          this.isPaused = false;
          this.animationFrameId = null;
          this.animationStartTime = null;
          this.pauseTime = null;
          this.speedMultiplier = 1;
          this.totalElapsed = 0;

          // Configuration
          this.config = {
            STEM_HEIGHT: 400,
            STEM_WIDTH: 6,
            PETAL_HEIGHT: 140,
            PETAL_WIDTH: 60,
            LEAF_WIDTH: 60,
            LEAF_HEIGHT: 30,
            NUM_PETALS: 6,
            NUM_STAMENS: 6,

            // Leaf positions: [height from bottom, isLeft, angle, scale]
            LEAF_POSITIONS: [
              { heightPos: 100, isLeft: true, angle: -45, scale: 0.8 },
              { heightPos: 180, isLeft: false, angle: 45, scale: 0.9 },
              { heightPos: 250, isLeft: true, angle: -30, scale: 1.0 },
            ],

            // Animation timings in milliseconds
            TIMINGS: {
              STEM_GROWTH: 1500,
              LEAF_GROWTH: 500,
              BLOOM_START: 1200,
              BLOOM_DURATION: 2000,
              REPRODUCTIVE_START: 1500,
              REPRODUCTIVE_DURATION: 1500,
              TOTAL: 3500,
            },
          };

          // State
          this.elements = {
            stem: null,
            leaves: [],
            petals: [],
            stamens: [],
            pistil: null,
            head: null,
          };

          this.init();
          this.setupEventListeners();
        }

        init() {
          this.clear();
          this.createFlower();
          this.resetToInitialState();
        }

        createFlower() {
          this.createStem();
          this.createLeaves();
          this.createFlowerHead();
        }

        createStem() {
          const stem = document.createElement("div");
          stem.className = "stem";
          stem.setAttribute("aria-hidden", "true");
          this.container.appendChild(stem);
          this.elements.stem = stem;
        }

        createLeaves() {
          this.elements.leaves = this.config.LEAF_POSITIONS.map(
            (config, index) => {
              const leaf = document.createElement("div");
              leaf.className = "leaf";
              leaf.setAttribute("aria-hidden", "true");
              leaf.dataset.index = index;

              // Position
              leaf.style.bottom = `${config.heightPos}px`;

              if (config.isLeft) {
                leaf.style.right = "50%";
                leaf.style.transformOrigin = "bottom right";
                leaf.style.borderRadius = "80% 0% 80% 0%";
              } else {
                leaf.style.left = "50%";
                leaf.style.transformOrigin = "bottom left";
                leaf.style.borderRadius = "0% 80% 0% 80%";
              }

              this.container.appendChild(leaf);
              return { element: leaf, ...config };
            },
          );
        }

        createFlowerHead() {
          const head = document.createElement("div");
          head.className = "flower-center";
          head.setAttribute("aria-hidden", "true");
          this.container.appendChild(head);
          this.elements.head = head;

          // Create petals
          this.elements.petals = Array.from(
            { length: this.config.NUM_PETALS },
            (_, index) => {
              const petal = document.createElement("div");
              const isInner = index % 2 === 0;
              petal.className = `petal ${isInner ? "inner" : "outer"}`;
              petal.dataset.index = index;

              // Add spots for realism
              for (let i = 0; i < 15; i++) {
                const spot = document.createElement("div");
                spot.className = "petal-spot";
                spot.style.left = `${30 + Math.random() * 40}%`;
                spot.style.bottom = `${20 + Math.random() * 40}%`;
                const size = 2 + Math.random() * 2;
                spot.style.width = `${size}px`;
                spot.style.height = `${size}px`;
                petal.appendChild(spot);
              }

              head.appendChild(petal);
              return { element: petal, angle: index * 60 };
            },
          );

          // Create stamens
          this.elements.stamens = Array.from(
            { length: this.config.NUM_STAMENS },
            (_, index) => {
              const stamen = document.createElement("div");
              stamen.className = "stamen";
              stamen.dataset.index = index;

              const anther = document.createElement("div");
              anther.className = "anther";
              stamen.appendChild(anther);

              head.appendChild(stamen);
              return { element: stamen, angle: index * 60 + 30 };
            },
          );

          // Create pistil
          const pistil = document.createElement("div");
          pistil.className = "pistil";

          const stigma = document.createElement("div");
          stigma.className = "stigma";
          pistil.appendChild(stigma);

          head.appendChild(pistil);
          this.elements.pistil = pistil;
        }

        resetToInitialState() {
          // Reset stem
          this.elements.stem.style.height = "0px";
          this.elements.stem.style.opacity = "1";

          // Reset leaves
          this.elements.leaves.forEach((leaf) => {
            leaf.element.style.width = "0px";
            leaf.element.style.height = "0px";
            leaf.element.style.transform = "scale(0)";
            leaf.element.style.opacity = "0";
          });

          // Reset petals
          this.elements.petals.forEach((petal) => {
            petal.element.style.height = "0px";
            petal.element.style.opacity = "0";
            petal.element.style.transform = `translateX(-50%) rotate(${petal.angle}deg) scale(0)`;
          });

          // Reset reproductive parts
          this.elements.stamens.forEach((stamen) => {
            stamen.element.style.height = "0px";
            stamen.element.style.opacity = "0";
          });

          this.elements.pistil.style.height = "0px";
          this.elements.pistil.style.opacity = "0";

          // Position head at bottom
          this.elements.head.style.top = `${window.innerHeight}px`;
        }

        play() {
          if (this.isAnimating && !this.isPaused) return;

          if (this.isPaused) {
            this.resume();
            return;
          }

          this.isAnimating = true;
          this.isPaused = false;
          this.totalElapsed = 0;
          this.resetToInitialState();
          this.animationStartTime = performance.now();

          this.animate();
        }

        pause() {
          if (!this.isAnimating || this.isPaused) return;

          this.isPaused = true;
          this.pauseTime = performance.now();
          if (this.animationFrameId) {
            cancelAnimationFrame(this.animationFrameId);
            this.animationFrameId = null;
          }
        }

        resume() {
          if (!this.isPaused) return;

          this.isPaused = false;
          const pauseDuration = performance.now() - this.pauseTime;
          this.animationStartTime += pauseDuration;

          this.animate();
        }

        stop() {
          this.isAnimating = false;
          this.isPaused = false;
          if (this.animationFrameId) {
            cancelAnimationFrame(this.animationFrameId);
            this.animationFrameId = null;
          }
        }

        reset() {
          this.stop();
          this.resetToInitialState();
        }

        setSpeed(multiplier) {
          this.speedMultiplier = multiplier;
        }

        toggleSpeed() {
          const speeds = [1, 1.5, 2];
          const currentIndex = speeds.indexOf(this.speedMultiplier);
          const nextIndex = (currentIndex + 1) % speeds.length;
          this.setSpeed(speeds[nextIndex]);
        }

        animate() {
          if (!this.isAnimating || this.isPaused) return;

          const animateFrame = (currentTime) => {
            if (!this.isAnimating || this.isPaused) return;

            if (!this.animationStartTime) {
              this.animationStartTime = currentTime;
            }

            let elapsed =
              (currentTime - this.animationStartTime) * this.speedMultiplier;
            this.totalElapsed = elapsed;

            // 1. Grow stem
            this.animateStem(elapsed);

            // 2. Grow leaves as stem passes their positions
            this.animateLeaves(elapsed);

            // 3. Bloom flower
            this.animateFlower(elapsed);

            // 4. Continue or stop animation
            if (elapsed < this.config.TIMINGS.TOTAL) {
              this.animationFrameId = requestAnimationFrame(animateFrame);
            } else {
              this.completeAnimation();
            }
          };

          this.animationFrameId = requestAnimationFrame(animateFrame);
        }

        animateStem(elapsed) {
          const progress = Math.min(
            elapsed / this.config.TIMINGS.STEM_GROWTH,
            1,
          );
          const easedProgress = this.easeOutQuad(progress);
          const currentHeight = this.config.STEM_HEIGHT * easedProgress;

          this.elements.stem.style.height = `${currentHeight}px`;
          this.elements.head.style.top = `${window.innerHeight - currentHeight}px`;
        }

        animateLeaves(elapsed) {
          const stemProgress = Math.min(
            elapsed / this.config.TIMINGS.STEM_GROWTH,
            1,
          );
          const currentStemHeight =
            this.config.STEM_HEIGHT * this.easeOutQuad(stemProgress);

          this.elements.leaves.forEach((leaf) => {
            if (currentStemHeight > leaf.heightPos) {
              const heightPast = currentStemHeight - leaf.heightPos;
              const leafProgress = Math.min(heightPast / 50, 1);
              const easedLeaf = this.easeOutBack(leafProgress);

              const width = this.config.LEAF_WIDTH * leaf.scale * easedLeaf;
              const height = this.config.LEAF_HEIGHT * leaf.scale * easedLeaf;

              leaf.element.style.opacity = "1";
              leaf.element.style.width = `${width}px`;
              leaf.element.style.height = `${height}px`;
              leaf.element.style.transform = `rotate(${leaf.angle}deg)`;
            }
          });
        }

        animateFlower(elapsed) {
          // Bloom petals
          if (elapsed > this.config.TIMINGS.BLOOM_START) {
            const bloomProgress = Math.min(
              (elapsed - this.config.TIMINGS.BLOOM_START) /
                this.config.TIMINGS.BLOOM_DURATION,
              1,
            );

            this.elements.petals.forEach((petal, index) => {
              let petalProgress = Math.max(0, bloomProgress - index * 0.05);
              petalProgress = Math.min(petalProgress * 1.5, 1);
              const easedProgress = this.easeOutBack(petalProgress);

              petal.element.style.opacity = "1";
              petal.element.style.height = `${this.config.PETAL_HEIGHT * easedProgress}px`;
              petal.element.style.transform = `
                            translateX(-50%) 
                            rotate(${petal.angle}deg) 
                            rotateX(${-50 * easedProgress}deg)
                        `;
            });

            // Animate reproductive parts (stamens and pistil)
            if (elapsed > this.config.TIMINGS.REPRODUCTIVE_START) {
              const reproProgress = Math.min(
                (elapsed - this.config.TIMINGS.REPRODUCTIVE_START) /
                  this.config.TIMINGS.REPRODUCTIVE_DURATION,
                1,
              );
              const easedRepro = this.easeOutCubic(reproProgress);

              this.elements.pistil.style.opacity = "1";
              this.elements.pistil.style.height = `${120 * easedRepro}px`;

              this.elements.stamens.forEach((stamen) => {
                stamen.element.style.opacity = "1";
                stamen.element.style.height = `${100 * easedRepro}px`;
                stamen.element.style.transform = `
                                translateX(-50%) 
                                rotate(${stamen.angle}deg) 
                                rotateX(-25deg)
                            `;
              });
            }
          }
        }

        completeAnimation() {
          this.isAnimating = false;
          this.animationFrameId = null;

          // Ensure final state
          this.elements.stem.style.height = `${this.config.STEM_HEIGHT}px`;
          this.elements.head.style.top = `${window.innerHeight - this.config.STEM_HEIGHT}px`;

          this.elements.leaves.forEach((leaf) => {
            const width = this.config.LEAF_WIDTH * leaf.scale;
            const height = this.config.LEAF_HEIGHT * leaf.scale;
            leaf.element.style.opacity = "1";
            leaf.element.style.width = `${width}px`;
            leaf.element.style.height = `${height}px`;
            leaf.element.style.transform = `rotate(${leaf.angle}deg)`;
          });

          this.elements.petals.forEach((petal) => {
            petal.element.style.opacity = "1";
            petal.element.style.height = `${this.config.PETAL_HEIGHT}px`;
            petal.element.style.transform = `
                        translateX(-50%) 
                        rotate(${petal.angle}deg) 
                        rotateX(-50deg)
                    `;
          });

          this.elements.stamens.forEach((stamen) => {
            stamen.element.style.opacity = "1";
            stamen.element.style.height = "100px";
          });

          this.elements.pistil.style.opacity = "1";
          this.elements.pistil.style.height = "120px";
        }

        clear() {
          this.container.innerHTML = "";
          this.stop();
        }

        setupEventListeners() {
          // Handle window resize
          let resizeTimeout;
          window.addEventListener("resize", () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
              if (!this.isAnimating) {
                this.resetToInitialState();
              }
            }, 250);
          });
        }

        // Easing functions
        easeOutQuad(t) {
          return t * (2 - t);
        }

        easeOutBack(t) {
          const c1 = 1.70158;
          const c3 = c1 + 1;
          return 1 + c3 * Math.pow(t - 1, 3) + c1 * Math.pow(t - 1, 2);
        }

        easeOutCubic(t) {
          return 1 - Math.pow(1 - t, 3);
        }
      }

      // Initialize when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        const lilyAnimation = new LilyAnimation("animation-container");

        // Make accessible for debugging
        window.lilyAnimation = lilyAnimation;

        // Auto-play after a brief delay (optional)
        setTimeout(() => {
          lilyAnimation.play();
        }, 1000);
      });
    </script>
  </body>
</html>
